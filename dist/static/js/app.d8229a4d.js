(function(){"use strict";var e={678:function(e,t,s){s.r(t);class r{constructor(){this.recorder=null,this.events=[],this.isRecording=!1,this.listeners=[],this.recordingId=null,this.recordingStartTime=null,this.maxRecordingDuration=18e4,console.log("GlobalRecorder：初始化完成")}static getInstance(){return r.instance||(r.instance=new r),r.instance}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}emit(e,t){this.listeners.forEach((s=>{try{s(e,t)}catch(r){console.error("监听器执行错误:",r)}}))}async startRecording(e={}){if(this.isRecording)return console.warn("录制已在进行中"),!1;try{if(console.log("GlobalRecorder：开始录制..."),this.recordingId=`rec_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.recordingStartTime=Date.now(),this.events=[],"undefined"===typeof window.rrweb)throw new Error("rrweb库未找到，请确保已正确引入");if(this.recorder=window.rrweb.record({emit:e=>{this.events.push(e),console.log("GlobalRecorder：记录事件，类型:",e.type,"总数:",this.events.length)},checkoutEveryNms:3e4,recordCanvas:!0,collectFonts:!0,inlineStylesheet:!0,...e}),this.recorder&&"function"===typeof this.recorder)return this.isRecording=!0,this.emit("started",{recordingId:this.recordingId}),console.log("GlobalRecorder：录制开始成功"),!0;throw new Error("录制器初始化失败")}catch(t){return console.error("GlobalRecorder：开始录制失败:",t),this.isRecording=!1,this.emit("error",t),!1}}startTimeoutTimer(){this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.timeoutTimer=setTimeout((()=>{this.handleRecordingTimeout()}),this.maxRecordingDuration),console.log("全局录制器：超时定时器已启动，",this.maxRecordingDuration/1e3,"秒后超时")}async handleRecordingTimeout(){if(console.log("全局录制器：录制超时，自动停止录制"),this.isRecording)try{await this.stopRecording(),this.emit("timeout",{duration:this.maxRecordingDuration,message:"录制时间超过3分钟，已自动停止"})}catch(e){console.error("超时停止录制失败:",e)}}clearTimeoutTimer(){this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null,console.log("全局录制器：超时定时器已清除"))}async stopRecording(){if(!this.isRecording)return console.warn("录制未开始"),null;try{console.log("GlobalRecorder：停止录制..."),this.recorder&&"function"===typeof this.recorder&&this.recorder(),this.isRecording=!1;const e=[...this.events];return console.log("GlobalRecorder：录制停止成功, 事件数量:",e.length),console.log("GlobalRecorder：前3个事件:",e.slice(0,3)),this.emit("stopped",{events:e}),e}catch(e){return console.error("GlobalRecorder：停止录制失败:",e),this.isRecording=!1,this.emit("error",e),null}}getRecordingStatus(){return{isRecording:this.isRecording,recordingId:this.recordingId,eventCount:this.events.length,startTime:this.recordingStartTime}}async stopRecordingAndProcess(e={}){try{console.log("GlobalRecorder：停止录制并处理数据...");const t=await this.stopRecording();if(!t||0===t.length)return{success:!1,error:"录制数据为空"};console.log("GlobalRecorder：开始处理录制数据，事件数量:",t.length);const s=t.filter((e=>e&&void 0!==e.type&&e.timestamp));if(0===s.length)return{success:!1,error:"录制数据格式无效"};console.log("GlobalRecorder：有效事件数量:",s.length);const r=this.recordingStartTime?Date.now()-this.recordingStartTime:0,a={recordingId:this.recordingId,events:s,startTime:new Date(this.recordingStartTime).toISOString(),endTime:(new Date).toISOString(),duration:r,totalEvents:s.length,...e},o=JSON.stringify(a),i=new Blob([o]).size;if(console.log("GlobalRecorder：原始数据大小:",i,"字节"),"undefined"===typeof window.pako)throw new Error("pako压缩库未找到，请确保已正确引入");const n=window.pako.gzip(o),l=n.length,c=(100*(1-l/i)).toFixed(2)+"%";console.log("GlobalRecorder：压缩后大小:",l,"字节，压缩率:",c);const d={...a,compressedEvents:Array.from(n)},u={success:!0,recordingResult:{events:s,duration:r,eventCount:s.length},data:{recordingId:this.recordingId,startTime:a.startTime,endTime:a.endTime,duration:r,finalData:d,sizes:{original:i,compressed:l},compressionRatio:c}};return console.log("GlobalRecorder：数据处理完成"),u}catch(t){return console.error("GlobalRecorder：处理录制数据失败:",t),{success:!1,error:t.message}}}async finishRecording(e={}){console.log("GlobalRecorder：收到完成录制请求，业务数据:",e);try{const t=await this.stopRecordingAndProcess(e);return this.emit("recording-finished",t),t}catch(t){console.error("GlobalRecorder：完成录制失败:",t);const e={success:!1,error:t.message,message:"录制完成处理失败"};return this.emit("recording-finished",e),e}}}t["default"]=r},6164:function(e,t,s){var r=s(5471),a=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},o=[],i={name:"App"},n=i,l=s(1656),c=(0,l.A)(n,a,o,!1,null,null,null),d=c.exports,u=s(173),p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"simple-record"},[t("van-nav-bar",{attrs:{title:"页面录制",fixed:""}}),t("div",{staticClass:"content"},[t("div",{staticClass:"control-section"},[t("div",{staticClass:"status-info"},[t("div",{staticClass:"status-text"},[e.isRecording||e.recordData?e._e():t("span",[e._v("准备录制")]),e.isRecording?t("span",[e._v("正在录制中...")]):e._e(),!e.isRecording&&e.recordData?t("span",[e._v("录制完成")]):e._e()]),e.isRecording?t("div",{staticClass:"recording-indicator"},[t("div",{staticClass:"red-dot"}),t("span",[e._v("REC")])]):e._e()]),t("div",{staticClass:"control-buttons"},[e.isRecording||e.recordData?e._e():t("van-button",{attrs:{type:"primary",size:"large",block:"",round:"",loading:e.loading,icon:"video-o"},on:{click:e.startRecord}},[e._v(" 开始录制 ")]),e.isRecording?t("van-button",{attrs:{type:"danger",size:"large",block:"",round:"",loading:e.loading,icon:"stop"},on:{click:e.stopRecord}},[e._v(" 停止录制 ")]):e._e(),!e.isRecording&&e.recordData?t("div",{staticClass:"action-buttons"},[t("van-button",{attrs:{type:"primary",size:"large",round:"",icon:"play"},on:{click:e.playRecord}},[e._v(" 播放回放 ")]),t("van-button",{attrs:{type:"info",size:"large",round:"",loading:e.downloading,icon:"download"},on:{click:e.downloadCompressedFile}},[e._v(" 下载压缩文件 ")]),t("van-button",{attrs:{type:"success",size:"large",round:"",loading:e.uploading,icon:"cloud-upload"},on:{click:e.uploadRecord}},[e._v(" 上传录制 ")]),t("van-button",{attrs:{size:"large",round:"",icon:"refresh"},on:{click:e.resetRecord}},[e._v(" 重新录制 ")])],1):e._e()],1)]),e.recordData?t("div",{staticClass:"record-info"},[t("van-cell-group",{attrs:{title:"录制信息"}},[t("van-cell",{attrs:{title:"录制时长",value:e.recordDuration}}),t("van-cell",{attrs:{title:"事件数量",value:e.recordData.events?e.recordData.events.length:0}}),t("van-cell",{attrs:{title:"数据大小",value:e.recordSize}}),t("van-cell",{attrs:{title:"录制时间",value:e.recordTime}})],1)],1):e._e(),e.showPlayer?t("div",{staticClass:"player-section"},[t("div",{staticClass:"player-header"},[t("h3",[e._v("录制回放")]),t("van-button",{attrs:{size:"small",icon:"cross"},on:{click:e.closePlayer}},[e._v("关闭")])],1),t("div",{ref:"playerContainer",staticClass:"player-container"}),t("div",{staticClass:"player-controls"},[t("van-button",{attrs:{size:"small",icon:e.isPlaying?"pause":"play"},on:{click:e.togglePlay}},[e._v(" "+e._s(e.isPlaying?"暂停":"播放")+" ")]),t("van-button",{attrs:{size:"small",icon:"replay"},on:{click:e.resetPlayer}},[e._v("重播")])],1)]):e._e(),t("div",{staticClass:"demo-section"},[t("van-cell-group",{attrs:{title:"演示操作区域"}},[t("van-cell",{attrs:{title:"点击这里","is-link":""},on:{click:e.demoClick}}),t("van-field",{attrs:{label:"输入文本",placeholder:"在这里输入一些文字"},model:{value:e.demoText,callback:function(t){e.demoText=t},expression:"demoText"}}),t("van-cell",{attrs:{title:"切换开关"},scopedSlots:e._u([{key:"right-icon",fn:function(){return[t("van-switch",{model:{value:e.demoSwitch,callback:function(t){e.demoSwitch=t},expression:"demoSwitch"}})]},proxy:!0}])})],1),t("div",{staticClass:"demo-buttons"},[t("van-button",{attrs:{type:"primary"},on:{click:e.demoAlert}},[e._v("显示弹窗")]),t("van-button",{attrs:{type:"warning"},on:{click:e.demoToast}},[e._v("显示提示")])],1)],1),t("div",{staticClass:"navigation-section"},[t("van-cell-group",{attrs:{title:"录制模式"}},[t("van-cell",{attrs:{title:"多页面录制","is-link":""},on:{click:e.goToMultiPage}})],1)],1)])],1)},h=[],m=(s(2505),{name:"SimpleRecord",data(){return{isRecording:!1,loading:!1,uploading:!1,downloading:!1,recordData:null,recordTime:"",stopFn:null,events:[],showPlayer:!1,player:null,isPlaying:!1,demoText:"",demoSwitch:!1}},computed:{recordDuration(){if(!this.recordData||!this.recordData.metadata)return"0秒";const e=Math.round(this.recordData.metadata.duration/1e3);return`${e}秒`},recordSize(){if(!this.recordData)return"0KB";const e=JSON.stringify(this.recordData).length;return`${(e/1024).toFixed(2)}KB`}},methods:{async startRecord(){this.loading=!0;try{if(await this.waitForPageLoad(),this.events=[],this.recordData=null,"undefined"===typeof window.rrweb)throw new Error("rrweb库未找到，请确保已正确引入");console.log("SimpleRecord：开始录制，rrweb版本:",window.rrweb),this.stopFn=window.rrweb.record({emit:e=>{this.events.push(e),console.log("SimpleRecord：记录事件，类型:",e.type,"总数:",this.events.length)},recordCanvas:!0,collectFonts:!0,checkoutEveryNms:3e4}),this.isRecording=!0,this.recordTime=(new Date).toLocaleString(),this.$toast.success("开始录制"),console.log("SimpleRecord：录制启动成功，stopFn:",typeof this.stopFn)}catch(e){console.error("录制失败:",e),this.$toast.fail("录制失败: "+e.message)}finally{this.loading=!1}},async stopRecord(){this.loading=!0;try{this.stopFn&&(this.stopFn(),this.stopFn=null),this.isRecording=!1,this.recordData={events:this.events,metadata:{recordTime:Date.now(),eventsCount:this.events.length,duration:this.events.length>0?this.events[this.events.length-1].timestamp-this.events[0].timestamp:0}},this.$toast.success("录制完成")}catch(e){console.error("停止录制失败:",e),this.$toast.fail("停止录制失败")}finally{this.loading=!1}},async playRecord(){if(this.recordData&&this.recordData.events)if(this.recordData.events.length<2)this.$toast.fail("录制事件不足，无法回放");else{this.showPlayer=!0,await this.$nextTick();try{if(this.$refs.playerContainer&&(this.$refs.playerContainer.innerHTML=""),"undefined"===typeof window.rrwebPlayer)throw new Error("rrweb-player库未找到，请确保已正确引入");this.player=new window.rrwebPlayer({target:this.$refs.playerContainer,props:{events:this.recordData.events,width:375,height:400,autoPlay:!1,showController:!0,skipInactive:!0,speed:1}}),this.isPlaying=!1,this.$toast.success("录制加载成功"),this.player&&this.player.addEventListener&&this.player.addEventListener("finish",(()=>{this.isPlaying=!1}))}catch(e){console.error("播放失败:",e),this.$toast.fail("播放失败: "+e.message),this.showPlayer=!1}}else this.$toast.fail("没有录制数据")},async uploadRecord(){if(this.recordData){this.uploading=!0;try{const e=await this.generateCompressedFile();if(!e.success)return void this.$toast.fail(e.message);console.log("上传数据:",e.data),console.log("文件大小:",(e.size/1024/1024).toFixed(2)+"MB"),await new Promise((e=>setTimeout(e,2e3))),this.$toast.success(`上传成功 (${(e.size/1024/1024).toFixed(2)}MB)`)}catch(e){console.error("上传失败:",e),this.$toast.fail("上传失败")}finally{this.uploading=!1}}else this.$toast.fail("没有录制数据")},async generateCompressedFile(){try{const e=2097152;let t=this.optimizeRecordData(this.recordData);if("undefined"===typeof window.pako)throw new Error("pako压缩库未找到，请确保已正确引入");const s=JSON.stringify(t),r=window.pako.gzip(s),a={compressed:!0,data:Array.from(r),originalSize:s.length,compressedSize:r.length,metadata:t.metadata,timestamp:(new Date).toISOString()},o=JSON.stringify(a),i=o.length;if(console.log("文件大小检查:"),console.log("原始数据:",(s.length/1024).toFixed(2)+"KB"),console.log("压缩后:",(r.length/1024).toFixed(2)+"KB"),console.log("最终JSON:",(i/1024).toFixed(2)+"KB"),console.log("压缩比:",(100*(1-r.length/s.length)).toFixed(2)+"%"),i>e){const s=this.furtherOptimizeData(t),r=window.pako.gzip(JSON.stringify(s)),a={compressed:!0,data:Array.from(r),originalSize:JSON.stringify(s).length,compressedSize:r.length,metadata:s.metadata,timestamp:(new Date).toISOString(),optimized:!0},o=JSON.stringify(a),i=o.length;return console.log("进一步优化后:",(i/1024).toFixed(2)+"KB"),i>e?{success:!1,message:`文件过大 (${(i/1024/1024).toFixed(2)}MB)，请缩短录制时间`}:{success:!0,data:a,size:i,optimized:!0}}return{success:!0,data:a,size:i,optimized:!1}}catch(e){return console.error("压缩失败:",e),{success:!1,message:"数据压缩失败"}}},optimizeRecordData(e){const t={events:e.events.map((e=>{const t={type:e.type,timestamp:e.timestamp};if(e.data)switch(t.data={},e.type){case 0:case 1:t.data={href:e.data.href,width:e.data.width,height:e.data.height};break;case 2:t.data={node:e.data.node,initialOffset:e.data.initialOffset};break;case 3:t.data={source:e.data.source,type:e.data.type,id:e.data.id},e.data.positions&&(t.data.positions=e.data.positions),e.data.texts&&(t.data.texts=e.data.texts),e.data.attributes&&(t.data.attributes=e.data.attributes);break;default:t.data=e.data}return t})),metadata:e.metadata};return t},furtherOptimizeData(e){const t=[],s=100;let r=0;return e.events.forEach((e=>{(0===e.type||1===e.type||2===e.type||e.timestamp-r>=s)&&(t.push(e),r=e.timestamp)})),{events:t,metadata:{...e.metadata,originalEventsCount:e.events.length,sampledEventsCount:t.length,optimized:!0}}},async downloadCompressedFile(){if(this.recordData){this.downloading=!0;try{const e=await this.generateCompressedFile();if(!e.success)return void this.$toast.fail(e.message);const t=(new Date).toISOString().replace(/[:.]/g,"-"),s=`record-compressed-${t}.json`,r=JSON.stringify(e.data,null,2);this.downloadFile(r,s,"application/json");const a=(e.size/1024).toFixed(2),o=e.optimized?" (已优化)":"";this.$toast.success(`文件已下载 (${a}KB)${o}`)}catch(e){console.error("下载失败:",e),this.$toast.fail("下载失败")}finally{this.downloading=!1}}else this.$toast.fail("没有录制数据")},downloadFile(e,t,s){const r=new Blob([e],{type:s}),a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)},resetRecord(){this.recordData=null,this.events=[],this.closePlayer(),this.$toast.success("已重置，可以重新录制")},togglePlay(){if(this.player)try{this.isPlaying?"function"===typeof this.player.pause&&this.player.pause():"function"===typeof this.player.play&&this.player.play(),this.isPlaying=!this.isPlaying}catch(e){console.warn("播放控制出错:",e),this.$toast.fail("播放控制失败")}},resetPlayer(){if(this.player)try{"function"===typeof this.player.goto?this.player.goto(0):"function"===typeof this.player.setCurrentTime&&this.player.setCurrentTime(0),this.isPlaying=!1}catch(e){console.warn("重置播放器出错:",e),this.$toast.fail("重置失败")}},closePlayer(){if(this.player){try{"function"===typeof this.player.destroy?this.player.destroy():"function"===typeof this.player.$destroy?this.player.$destroy():this.player.$el&&this.player.$el.parentNode&&this.player.$el.parentNode.removeChild(this.player.$el)}catch(e){console.warn("播放器销毁时出现警告:",e)}this.player=null}this.$refs.playerContainer&&(this.$refs.playerContainer.innerHTML=""),this.showPlayer=!1,this.isPlaying=!1},waitForPageLoad(){return new Promise((e=>{"complete"===document.readyState?setTimeout(e,500):window.addEventListener("load",(()=>{setTimeout(e,500)}))}))},demoClick(){this.$toast("你点击了演示按钮")},demoAlert(){this.$dialog.alert({message:"这是一个演示弹窗"})},demoToast(){this.$toast.success("这是一个演示提示")},goToMultiPage(){this.$router.push("/multi-page")}},beforeDestroy(){this.isRecording&&this.stopFn&&this.stopFn(),this.closePlayer()}}),g=m,v=(0,l.A)(g,p,h,!1,null,"14bad980",null),y=(v.exports,function(){var e=this,t=e._self._c;return t("div",{staticClass:"multi-page-record"},[t("van-nav-bar",{attrs:{title:"多页面录制",fixed:""}}),t("div",{staticClass:"content"},[t("div",{staticClass:"control-section"},[t("div",{staticClass:"status-info"},[t("div",{staticClass:"status-text"},[e.isRecording||e.recordData?e._e():t("span",[e._v("准备录制")]),e.isRecording?t("span",[e._v("正在录制中... ("+e._s(e.currentPage)+")")]):e._e(),!e.isRecording&&e.recordData?t("span",[e._v("录制完成")]):e._e()]),e.isRecording?t("div",{staticClass:"recording-indicator"},[t("div",{staticClass:"red-dot"}),t("span",[e._v("REC")])]):e._e()]),t("div",{staticClass:"control-buttons"},[e.isRecording||e.recordData?e._e():t("van-button",{attrs:{type:"primary",size:"large",block:"",round:"",loading:e.loading,icon:"video-o"},on:{click:e.startRecord}},[e._v(" 开始录制 ")]),e.isRecording?t("van-button",{attrs:{type:"danger",size:"large",block:"",round:"",loading:e.loading,icon:"stop"},on:{click:e.stopRecord}},[e._v(" 停止录制 ")]):e._e(),!e.isRecording&&e.recordData?t("div",{staticClass:"action-buttons"},[t("van-button",{attrs:{type:"primary",size:"large",round:"",icon:"play"},on:{click:e.playRecord}},[e._v(" 播放回放 ")]),t("van-button",{attrs:{type:"info",size:"large",round:"",loading:e.downloading,icon:"download"},on:{click:e.downloadCompressedFile}},[e._v(" 下载压缩文件 ")]),t("van-button",{attrs:{type:"success",size:"large",round:"",loading:e.uploading,icon:"cloud-upload"},on:{click:e.uploadRecord}},[e._v(" 上传录制 ")]),t("van-button",{attrs:{size:"large",round:"",icon:"refresh"},on:{click:e.resetRecord}},[e._v(" 重新录制 ")])],1):e._e()],1)]),e.isRecording?t("div",{staticClass:"navigation-section"},[t("van-cell-group",{attrs:{title:"页面导航 (录制中可跳转)"}},[t("van-cell",{class:{active:"首页"===e.currentPage},attrs:{title:"首页","is-link":""},on:{click:function(t){return e.navigateTo("home")}}}),t("van-cell",{class:{active:"产品列表"===e.currentPage},attrs:{title:"产品列表","is-link":""},on:{click:function(t){return e.navigateTo("products")}}}),t("van-cell",{class:{active:"产品详情"===e.currentPage},attrs:{title:"产品详情","is-link":""},on:{click:function(t){return e.navigateTo("product-detail")}}}),t("van-cell",{class:{active:"购买页面"===e.currentPage},attrs:{title:"购买页面","is-link":""},on:{click:function(t){return e.navigateTo("purchase")}}}),t("van-cell",{class:{active:"赎回页面"===e.currentPage},attrs:{title:"赎回页面","is-link":""},on:{click:function(t){return e.navigateTo("redeem")}}})],1)],1):e._e(),e.recordData?t("div",{staticClass:"record-info"},[t("van-cell-group",{attrs:{title:"录制信息"}},[t("van-cell",{attrs:{title:"录制时长",value:e.recordDuration}}),t("van-cell",{attrs:{title:"事件数量",value:e.recordData.events?e.recordData.events.length:0}}),t("van-cell",{attrs:{title:"页面数量",value:e.visitedPages.length}}),t("van-cell",{attrs:{title:"数据大小",value:e.recordSize}}),t("van-cell",{attrs:{title:"录制时间",value:e.recordTime}})],1),t("van-cell-group",{attrs:{title:"访问页面"}},e._l(e.visitedPages,(function(e,s){return t("van-cell",{key:s,attrs:{title:`${s+1}. ${e.name}`,value:e.duration}})})),1)],1):e._e(),e.showPlayer?t("div",{staticClass:"player-section"},[t("div",{staticClass:"player-header"},[t("h3",[e._v("录制回放")]),t("van-button",{attrs:{size:"small",icon:"cross"},on:{click:e.closePlayer}},[e._v("关闭")])],1),t("div",{ref:"playerContainer",staticClass:"player-container"}),t("div",{staticClass:"player-controls"},[t("van-button",{attrs:{size:"small",icon:e.isPlaying?"pause":"play"},on:{click:e.togglePlay}},[e._v(" "+e._s(e.isPlaying?"暂停":"播放")+" ")]),t("van-button",{attrs:{size:"small",icon:"replay"},on:{click:e.resetPlayer}},[e._v("重播")])],1)]):e._e(),t("div",{staticClass:"current-page-content"},[t(e.currentPageComponent,{tag:"component",on:{"page-change":e.onPageChange}})],1)])],1)}),f=[],R=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home-page"},[e._m(0),t("div",{staticClass:"features"},[t("div",{staticClass:"feature-item",on:{click:function(t){return e.handleClick("安全保障")}}},[t("div",{staticClass:"feature-icon"},[e._v("🛡️")]),t("div",{staticClass:"feature-text"},[e._v("安全保障")])]),t("div",{staticClass:"feature-item",on:{click:function(t){return e.handleClick("收益稳定")}}},[t("div",{staticClass:"feature-icon"},[e._v("📈")]),t("div",{staticClass:"feature-text"},[e._v("收益稳定")])]),t("div",{staticClass:"feature-item",on:{click:function(t){return e.handleClick("专业服务")}}},[t("div",{staticClass:"feature-icon"},[e._v("👨‍💼")]),t("div",{staticClass:"feature-text"},[e._v("专业服务")])])]),t("div",{staticClass:"demo-actions"},[t("van-button",{attrs:{type:"primary",block:""},on:{click:e.showDialog}},[e._v("查看详情")]),t("van-field",{attrs:{label:"用户姓名",placeholder:"请输入您的姓名"},model:{value:e.userInput,callback:function(t){e.userInput=t},expression:"userInput"}}),t("van-button",{attrs:{type:"info",block:""},on:{click:e.submitInfo}},[e._v("提交信息")])],1)])},b=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"welcome-banner"},[t("h2",[e._v("欢迎使用理财产品")]),t("p",[e._v("为您提供专业的理财服务")])])}],w={name:"HomePage",data(){return{userInput:""}},methods:{handleClick(e){this.$toast(`点击了${e}`)},showDialog(){this.$dialog.alert({title:"产品详情",message:"我们提供多种理财产品，满足不同客户的需求。"})},submitInfo(){this.userInput?this.$toast.success(`欢迎 ${this.userInput}！`):this.$toast.fail("请输入姓名")}}},C=w,_=(0,l.A)(C,R,b,!1,null,"34f6a022",null),k=_.exports,$=function(){var e=this,t=e._self._c;return t("div",{staticClass:"products-page"},[e._m(0),t("div",{staticClass:"filter-section"},[t("van-field",{attrs:{placeholder:"搜索产品名称"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),t("div",{staticClass:"filter-buttons"},e._l(e.productTypes,(function(s){return t("van-button",{key:s,attrs:{size:"small",type:e.selectedType===s?"primary":"default"},on:{click:function(t){return e.filterByType(s)}}},[e._v(" "+e._s(s)+" ")])})),1)],1),t("div",{staticClass:"products-list"},e._l(e.filteredProducts,(function(s){return t("div",{key:s.id,staticClass:"product-card",on:{click:function(t){return e.selectProduct(s)}}},[t("div",{staticClass:"product-header"},[t("h4",[e._v(e._s(s.name))]),t("span",{staticClass:"product-rate"},[e._v(e._s(s.rate)+"%")])]),t("div",{staticClass:"product-info"},[t("div",{staticClass:"info-item"},[t("span",{staticClass:"label"},[e._v("起购金额:")]),t("span",{staticClass:"value"},[e._v(e._s(s.minAmount)+"万")])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"label"},[e._v("期限:")]),t("span",{staticClass:"value"},[e._v(e._s(s.period))])]),t("div",{staticClass:"info-item"},[t("span",{staticClass:"label"},[e._v("风险等级:")]),t("span",{staticClass:"value"},[e._v(e._s(s.riskLevel))])])]),t("div",{staticClass:"product-actions"},[t("van-button",{attrs:{size:"small",type:"info"},on:{click:function(t){return t.stopPropagation(),e.viewDetail(s)}}},[e._v("查看详情")]),t("van-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return t.stopPropagation(),e.buyProduct(s)}}},[e._v("立即购买")])],1)])})),0)])},P=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-header"},[t("h3",[e._v("理财产品列表")]),t("p",[e._v("为您精选优质理财产品")])])}],x={name:"ProductsPage",data(){return{searchText:"",selectedType:"全部",productTypes:["全部","稳健型","平衡型","进取型"],products:[{id:1,name:"稳健增利1号",rate:4.2,minAmount:1,period:"90天",riskLevel:"R2",type:"稳健型"},{id:2,name:"平衡收益2号",rate:5.8,minAmount:5,period:"180天",riskLevel:"R3",type:"平衡型"},{id:3,name:"进取成长3号",rate:7.5,minAmount:10,period:"365天",riskLevel:"R4",type:"进取型"},{id:4,name:"稳健保本4号",rate:3.8,minAmount:1,period:"60天",riskLevel:"R1",type:"稳健型"}]}},computed:{filteredProducts(){let e=this.products;return"全部"!==this.selectedType&&(e=e.filter((e=>e.type===this.selectedType))),this.searchText&&(e=e.filter((e=>e.name.toLowerCase().includes(this.searchText.toLowerCase())))),e}},methods:{filterByType(e){this.selectedType=e,this.$toast(`筛选: ${e}`)},selectProduct(e){this.$toast(`选择了 ${e.name}`)},viewDetail(e){this.$toast(`查看 ${e.name} 详情`)},buyProduct(e){this.$toast(`购买 ${e.name}`)}}},S=x,T=(0,l.A)(S,$,P,!1,null,"02f66d73",null),F=T.exports,z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"product-detail-page"},[t("div",{staticClass:"product-banner"},[t("h3",[e._v(e._s(e.product.name))]),t("div",{staticClass:"rate-display"},[e._v(e._s(e.product.rate)+"%")]),t("p",[e._v("预期年化收益率")])]),t("div",{staticClass:"product-details"},[t("van-cell-group",{attrs:{title:"产品信息"}},[t("van-cell",{attrs:{title:"起购金额",value:`${e.product.minAmount}万元`}}),t("van-cell",{attrs:{title:"产品期限",value:e.product.period}}),t("van-cell",{attrs:{title:"风险等级",value:e.product.riskLevel}}),t("van-cell",{attrs:{title:"募集状态",value:"募集中"}})],1),t("van-cell-group",{attrs:{title:"收益说明"}},[t("van-cell",{attrs:{title:"收益类型",value:"非保本浮动收益"}}),t("van-cell",{attrs:{title:"计息方式",value:"按日计息"}}),t("van-cell",{attrs:{title:"到期处理",value:"自动赎回"}})],1)],1),t("div",{staticClass:"demo-interactions"},[t("van-field",{attrs:{label:"投资金额",placeholder:"请输入投资金额",type:"number"},model:{value:e.investAmount,callback:function(t){e.investAmount=t},expression:"investAmount"}}),t("van-field",{attrs:{label:"客户姓名",placeholder:"请输入姓名"},model:{value:e.customerName,callback:function(t){e.customerName=t},expression:"customerName"}}),t("van-switch",{model:{value:e.agreeTerms,callback:function(t){e.agreeTerms=t},expression:"agreeTerms"}}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("我已阅读并同意产品协议")])],1),t("div",{staticClass:"action-buttons"},[t("van-button",{attrs:{type:"primary",block:""},on:{click:e.purchaseProduct}},[e._v("立即购买")]),t("van-button",{attrs:{type:"info",block:""},on:{click:e.addToFavorites}},[e._v("加入收藏")])],1)])},D=[],A={name:"ProductDetailPage",data(){return{product:{name:"稳健增利1号",rate:4.2,minAmount:1,period:"90天",riskLevel:"R2"},investAmount:"",customerName:"",agreeTerms:!1}},methods:{purchaseProduct(){this.agreeTerms?this.$toast.success("跳转到购买页面"):this.$toast.fail("请先同意产品协议")},addToFavorites(){this.$toast.success("已加入收藏")}}},I=A,N=(0,l.A)(I,z,D,!1,null,"5eb9d020",null),O=N.exports,E=function(){var e=this,t=e._self._c;return t("div",{staticClass:"purchase-page"},[e._m(0),t("div",{staticClass:"purchase-form"},[t("van-cell-group",{attrs:{title:"购买信息"}},[t("van-cell",{attrs:{title:"产品名称",value:"稳健增利1号"}}),t("van-cell",{attrs:{title:"预期收益率",value:"4.2%"}})],1),t("van-cell-group",{attrs:{title:"投资信息"}},[t("van-field",{attrs:{label:"投资金额",placeholder:"请输入投资金额",type:"number"},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}}),t("van-field",{attrs:{label:"投资人姓名",placeholder:"请输入姓名"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),t("van-field",{attrs:{label:"手机号码",placeholder:"请输入手机号"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}}),t("van-field",{attrs:{label:"身份证号",placeholder:"请输入身份证号"},model:{value:e.form.idCard,callback:function(t){e.$set(e.form,"idCard",t)},expression:"form.idCard"}})],1),t("div",{staticClass:"risk-notice"},[t("h4",[e._v("风险提示")]),t("p",[e._v("本产品为非保本浮动收益型产品，存在投资风险，请您仔细阅读产品说明书。")]),t("div",{staticClass:"agree-section"},[t("van-switch",{model:{value:e.form.agreeRisk,callback:function(t){e.$set(e.form,"agreeRisk",t)},expression:"form.agreeRisk"}}),t("span",[e._v("我已充分了解产品风险")])],1)]),t("div",{staticClass:"demo-actions"},[t("van-button",{attrs:{type:"warning",block:""},on:{click:e.calculateIncome}},[e._v("计算收益")]),t("van-button",{attrs:{type:"primary",block:""},on:{click:e.confirmPurchase}},[e._v("确认购买")])],1)],1)])},M=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-header"},[t("h3",[e._v("产品购买")])])}],B={name:"PurchasePage",data(){return{form:{amount:"",name:"",phone:"",idCard:"",agreeRisk:!1}}},methods:{calculateIncome(){if(!this.form.amount)return void this.$toast.fail("请输入投资金额");const e=(1e4*this.form.amount*.042*90/365).toFixed(2);this.$toast.success(`预计收益: ${e}元`)},confirmPurchase(){this.form.agreeRisk?this.form.amount&&this.form.name?this.$toast.success("购买成功！"):this.$toast.fail("请填写完整信息"):this.$toast.fail("请先确认风险提示")}}},L=B,W=(0,l.A)(L,E,M,!1,null,"75a3e44c",null),q=W.exports,j=function(){var e=this,t=e._self._c;return t("div",{staticClass:"redeem-page"},[e._m(0),t("div",{staticClass:"redeem-form"},[t("van-cell-group",{attrs:{title:"持仓信息"}},[t("van-cell",{attrs:{title:"产品名称",value:"稳健增利1号"}}),t("van-cell",{attrs:{title:"持有金额",value:"50,000.00元"}}),t("van-cell",{attrs:{title:"累计收益",value:"1,245.67元"}}),t("van-cell",{attrs:{title:"持有天数",value:"45天"}})],1),t("van-cell-group",{attrs:{title:"赎回信息"}},[t("van-field",{attrs:{label:"赎回金额",placeholder:"请输入赎回金额",type:"number"},model:{value:e.form.redeemAmount,callback:function(t){e.$set(e.form,"redeemAmount",t)},expression:"form.redeemAmount"}}),t("van-cell",{attrs:{title:"赎回类型"},scopedSlots:e._u([{key:"right-icon",fn:function(){return[t("van-switch",{on:{change:e.onRedeemTypeChange},model:{value:e.form.isFullRedeem,callback:function(t){e.$set(e.form,"isFullRedeem",t)},expression:"form.isFullRedeem"}}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e.form.isFullRedeem?"全部赎回":"部分赎回"))])]},proxy:!0}])}),t("van-field",{attrs:{label:"到账银行卡",placeholder:"请输入银行卡号"},model:{value:e.form.bankCard,callback:function(t){e.$set(e.form,"bankCard",t)},expression:"form.bankCard"}})],1),t("div",{staticClass:"redeem-notice"},[t("h4",[e._v("赎回说明")]),e._m(1),t("div",{staticClass:"agree-section"},[t("van-switch",{model:{value:e.form.agreeRedeem,callback:function(t){e.$set(e.form,"agreeRedeem",t)},expression:"form.agreeRedeem"}}),t("span",[e._v("我已了解赎回规则")])],1)]),t("div",{staticClass:"demo-actions"},[t("van-button",{attrs:{type:"warning",block:""},on:{click:e.calculateFee}},[e._v("计算手续费")]),t("van-button",{attrs:{type:"danger",block:""},on:{click:e.confirmRedeem}},[e._v("确认赎回")])],1)],1)])},H=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-header"},[t("h3",[e._v("产品赎回")])])},function(){var e=this,t=e._self._c;return t("ul",[t("li",[e._v("赎回申请提交后不可撤销")]),t("li",[e._v("资金将在T+1个工作日到账")]),t("li",[e._v("部分赎回最低保留金额1万元")])])}],J={name:"RedeemPage",data(){return{form:{redeemAmount:"",isFullRedeem:!1,bankCard:"",agreeRedeem:!1}}},methods:{onRedeemTypeChange(e){this.form.redeemAmount=e?"50000":""},calculateFee(){if(!this.form.redeemAmount)return void this.$toast.fail("请输入赎回金额");const e=(.001*this.form.redeemAmount).toFixed(2);this.$toast.success(`手续费: ${e}元`)},confirmRedeem(){this.form.agreeRedeem?this.form.redeemAmount&&this.form.bankCard?this.$toast.success("赎回申请提交成功！"):this.$toast.fail("请填写完整信息"):this.$toast.fail("请先确认赎回规则")}}},G=J,K=(0,l.A)(G,j,H,!1,null,"37ca8da5",null),U=K.exports,V={name:"MultiPageRecord",components:{HomePage:k,ProductsPage:F,ProductDetailPage:O,PurchasePage:q,RedeemPage:U},data(){return{isRecording:!1,loading:!1,uploading:!1,downloading:!1,recordData:null,recordTime:"",stopFn:null,events:[],currentPage:"首页",currentPageComponent:"HomePage",visitedPages:[],pageStartTime:null,showPlayer:!1,player:null,isPlaying:!1}},computed:{recordDuration(){if(!this.recordData||!this.recordData.metadata)return"0秒";const e=Math.round(this.recordData.metadata.duration/1e3);return`${e}秒`},recordSize(){if(!this.recordData)return"0KB";const e=JSON.stringify(this.recordData).length;return`${(e/1024).toFixed(2)}KB`}},methods:{async startRecord(){this.loading=!0;try{if(await this.waitForPageLoad(),this.events=[],this.recordData=null,this.visitedPages=[],this.pageStartTime=Date.now(),this.visitedPages.push({name:this.currentPage,startTime:this.pageStartTime,url:window.location.href}),"undefined"===typeof window.rrweb)throw new Error("rrweb库未找到，请确保已正确引入");this.stopFn=window.rrweb.record({emit:e=>{e.pageInfo={pageName:this.currentPage,url:window.location.href,timestamp:Date.now()},this.events.push(e)},recordCanvas:!0,collectFonts:!0,recordCrossOriginIframes:!0}),this.isRecording=!0,this.recordTime=(new Date).toLocaleString(),this.$toast.success("开始录制，可以跳转页面")}catch(e){console.error("录制失败:",e),this.$toast.fail("录制失败")}finally{this.loading=!1}},async stopRecord(){this.loading=!0;try{if(this.stopFn&&(this.stopFn(),this.stopFn=null),this.visitedPages.length>0){const e=this.visitedPages[this.visitedPages.length-1];e.endTime||(e.endTime=Date.now(),e.duration=`${Math.round((e.endTime-e.startTime)/1e3)}秒`)}this.isRecording=!1,this.recordData={events:this.events,metadata:{recordTime:Date.now(),eventsCount:this.events.length,duration:this.events.length>0?this.events[this.events.length-1].timestamp-this.events[0].timestamp:0,visitedPages:this.visitedPages,totalPages:this.visitedPages.length}},this.$toast.success("录制完成")}catch(e){console.error("停止录制失败:",e),this.$toast.fail("停止录制失败")}finally{this.loading=!1}},navigateTo(e){if(!this.isRecording)return;if(this.visitedPages.length>0){const e=this.visitedPages[this.visitedPages.length-1];e.endTime||(e.endTime=Date.now(),e.duration=`${Math.round((e.endTime-e.startTime)/1e3)}秒`)}const t={home:{name:"首页",component:"HomePage"},products:{name:"产品列表",component:"ProductsPage"},"product-detail":{name:"产品详情",component:"ProductDetailPage"},purchase:{name:"购买页面",component:"PurchasePage"},redeem:{name:"赎回页面",component:"RedeemPage"}},s=t[e];if(s){this.currentPage=s.name,this.currentPageComponent=s.component;const t=Date.now();this.visitedPages.push({name:s.name,startTime:t,url:window.location.href+"#"+e}),this.$toast(`已切换到${s.name}`)}},onPageChange(e){console.log("页面变化:",e)},async playRecord(){if(this.recordData&&this.recordData.events)if(this.recordData.events.length<2)this.$toast.fail("录制事件不足，无法回放");else{this.showPlayer=!0,await this.$nextTick();try{if(this.$refs.playerContainer&&(this.$refs.playerContainer.innerHTML=""),"undefined"===typeof window.rrwebPlayer)throw new Error("rrweb-player库未找到，请确保已正确引入");this.player=new window.rrwebPlayer({target:this.$refs.playerContainer,props:{events:this.recordData.events,width:375,height:400,autoPlay:!1,showController:!0,skipInactive:!0,speed:1}}),this.isPlaying=!1,this.$toast.success("录制加载成功"),this.player&&this.player.addEventListener&&this.player.addEventListener("finish",(()=>{this.isPlaying=!1}))}catch(e){console.error("播放失败:",e),this.$toast.fail("播放失败: "+e.message),this.showPlayer=!1}}else this.$toast.fail("没有录制数据")},async downloadCompressedFile(){if(this.recordData){this.downloading=!0;try{const e=await this.generateCompressedFile();if(!e.success)return void this.$toast.fail(e.message);const t=(new Date).toISOString().replace(/[:.]/g,"-"),s=`multi-page-record-${t}.json`,r=JSON.stringify(e.data,null,2);this.downloadFile(r,s,"application/json");const a=(e.size/1024).toFixed(2),o=e.optimized?" (已优化)":"";this.$toast.success(`文件已下载 (${a}KB)${o}`)}catch(e){console.error("下载失败:",e),this.$toast.fail("下载失败")}finally{this.downloading=!1}}else this.$toast.fail("没有录制数据")},async uploadRecord(){if(this.recordData){this.uploading=!0;try{const e=await this.generateCompressedFile();if(!e.success)return void this.$toast.fail(e.message);console.log("上传数据:",e.data),console.log("文件大小:",(e.size/1024/1024).toFixed(2)+"MB"),console.log("访问页面:",this.visitedPages),await new Promise((e=>setTimeout(e,2e3))),this.$toast.success(`上传成功 (${(e.size/1024/1024).toFixed(2)}MB)`)}catch(e){console.error("上传失败:",e),this.$toast.fail("上传失败")}finally{this.uploading=!1}}else this.$toast.fail("没有录制数据")},async generateCompressedFile(){try{const e=2097152;let t=this.optimizeRecordData(this.recordData);const s=JSON.stringify(t);if("undefined"===typeof window.pako)throw new Error("pako压缩库未找到，请确保已正确引入");const r=window.pako.gzip(s),a={compressed:!0,data:Array.from(r),originalSize:s.length,compressedSize:r.length,metadata:t.metadata,timestamp:(new Date).toISOString()},o=JSON.stringify(a),i=o.length;if(console.log("多页面录制压缩信息:"),console.log("原始数据:",(s.length/1024).toFixed(2)+"KB"),console.log("压缩后:",(r.length/1024).toFixed(2)+"KB"),console.log("最终JSON:",(i/1024).toFixed(2)+"KB"),i>e){const s=this.furtherOptimizeData(t),r=window.pako.gzip(JSON.stringify(s)),a={compressed:!0,data:Array.from(r),originalSize:JSON.stringify(s).length,compressedSize:r.length,metadata:s.metadata,timestamp:(new Date).toISOString(),optimized:!0},o=JSON.stringify(a),i=o.length;return i>e?{success:!1,message:`文件过大 (${(i/1024/1024).toFixed(2)}MB)，请缩短录制时间`}:{success:!0,data:a,size:i,optimized:!0}}return{success:!0,data:a,size:i,optimized:!1}}catch(e){return{success:!1,message:"数据压缩失败"}}},optimizeRecordData(e){const t={events:e.events.map((e=>{const t={type:e.type,timestamp:e.timestamp,pageInfo:e.pageInfo};if(e.data)switch(t.data={},e.type){case 0:case 1:t.data={href:e.data.href,width:e.data.width,height:e.data.height};break;case 2:t.data={node:e.data.node,initialOffset:e.data.initialOffset};break;case 3:t.data={source:e.data.source,type:e.data.type,id:e.data.id},e.data.positions&&(t.data.positions=e.data.positions),e.data.texts&&(t.data.texts=e.data.texts),e.data.attributes&&(t.data.attributes=e.data.attributes);break;default:t.data=e.data}return t})),metadata:e.metadata};return t},furtherOptimizeData(e){const t=[],s=150;let r=0;return e.events.forEach((e=>{(0===e.type||1===e.type||2===e.type||e.timestamp-r>=s)&&(t.push(e),r=e.timestamp)})),{events:t,metadata:{...e.metadata,originalEventsCount:e.events.length,sampledEventsCount:t.length,optimized:!0}}},downloadFile(e,t,s){const r=new Blob([e],{type:s}),a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)},waitForPageLoad(){return new Promise((e=>{"complete"===document.readyState?setTimeout(e,500):window.addEventListener("load",(()=>{setTimeout(e,500)}))}))},resetRecord(){this.recordData=null,this.events=[],this.visitedPages=[],this.currentPage="首页",this.currentPageComponent="HomePage",this.closePlayer(),this.$toast.success("已重置，可以重新录制")},togglePlay(){if(this.player)try{this.isPlaying?"function"===typeof this.player.pause&&this.player.pause():"function"===typeof this.player.play&&this.player.play(),this.isPlaying=!this.isPlaying}catch(e){console.warn("播放控制出错:",e),this.$toast.fail("播放控制失败")}},resetPlayer(){if(this.player)try{"function"===typeof this.player.goto?this.player.goto(0):"function"===typeof this.player.setCurrentTime&&this.player.setCurrentTime(0),this.isPlaying=!1}catch(e){console.warn("重置播放器出错:",e),this.$toast.fail("重置失败")}},closePlayer(){if(this.player){try{"function"===typeof this.player.destroy?this.player.destroy():"function"===typeof this.player.$destroy?this.player.$destroy():this.player.$el&&this.player.$el.parentNode&&this.player.$el.parentNode.removeChild(this.player.$el)}catch(e){console.warn("播放器销毁时出现警告:",e)}this.player=null}this.$refs.playerContainer&&(this.$refs.playerContainer.innerHTML=""),this.showPlayer=!1,this.isPlaying=!1}},beforeDestroy(){this.isRecording&&this.stopFn&&this.stopFn(),this.closePlayer()}},X=V,Q=(0,l.A)(X,y,f,!1,null,"23cfd779",null),Y=(Q.exports,function(){var e=this,t=e._self._c;return t("div",{staticClass:"router-index"},[t("van-nav-bar",{attrs:{title:"路由导航",fixed:""}}),t("div",{staticClass:"content"},[t("div",{staticClass:"section"},[t("h3",[e._v("录制功能")]),t("van-cell-group",[t("van-cell",{attrs:{title:"单页面录制","is-link":"",to:"/SimpleRecord"}}),t("van-cell",{attrs:{title:"多页面录制","is-link":"",to:"/multi-page"}})],1)],1),t("div",{staticClass:"section"},[t("h3",[e._v("业务页面")]),t("van-cell-group",[t("van-cell",{attrs:{title:"产品列表","is-link":"",to:"/"}}),t("van-cell",{attrs:{title:"产品详情","is-link":"",to:"/product/1"}}),t("van-cell",{attrs:{title:"传统购买流程","is-link":"",to:"/purchase/1"}}),t("van-cell",{attrs:{title:"产品赎回","is-link":"",to:"/redeem/1"}}),t("van-cell",{attrs:{title:"录制回放","is-link":"",to:"/player"}})],1)],1),t("div",{staticClass:"section"},[t("h3",[e._v("新分步购买流程")]),t("van-cell-group",[t("van-cell",{attrs:{title:"步骤1：确认产品","is-link":"",to:{name:"PurchaseStepOne",query:{id:1}}}}),t("van-cell",{attrs:{title:"步骤2：填写信息","is-link":"",to:{name:"PurchaseStepTwo",query:{id:1}}}}),t("van-cell",{attrs:{title:"步骤3：确认购买","is-link":"",to:{name:"PurchaseStepThree",query:{id:1}}}}),t("van-cell",{attrs:{title:"步骤4：购买完成","is-link":"",to:{name:"PurchaseStepFour",query:{id:1}}}})],1)],1),t("div",{staticClass:"section"},[t("h3",[e._v("Pages组件")]),t("van-cell-group",[t("van-cell",{attrs:{title:"首页组件","is-link":"",to:"/pages/home"}}),t("van-cell",{attrs:{title:"产品页面","is-link":"",to:"/pages/products"}}),t("van-cell",{attrs:{title:"产品详情页面","is-link":"",to:"/pages/product-detail"}}),t("van-cell",{attrs:{title:"购买页面","is-link":"",to:"/pages/purchase"}}),t("van-cell",{attrs:{title:"赎回页面","is-link":"",to:"/pages/redeem"}})],1)],1),e._m(0)])],1)}),Z=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"section"},[t("h3",[e._v("录制测试说明")]),t("div",{staticClass:"test-guide"},[t("h4",[e._v("测试新的录制功能：")]),t("ol",[t("li",[e._v('点击"产品列表"进入主页面')]),t("li",[e._v('点击"开始录制"按钮，会弹出录制权限申请弹框')]),t("li",[e._v('点击"同意录制"开始录制，会显示录制状态和时间')]),t("li",[e._v('点击任意产品的"立即购买"按钮')]),t("li",[e._v('选择"分步购买流程"')]),t("li",[e._v("按步骤完成购买流程（注意：超过3分钟会提示交易失败）")]),t("li",[e._v("在最后一步会自动停止录制并显示录制结果")])]),t("h4",[e._v("功能特点：")]),t("ul",[t("li",[e._v("✅ 录制前需要用户同意")]),t("li",[e._v("✅ 实时显示录制时间")]),t("li",[e._v("✅ 3分钟录制超时保护")]),t("li",[e._v("✅ 分步骤页面间跳转继续录制")]),t("li",[e._v("✅ 表单数据在步骤间自动保存")]),t("li",[e._v("✅ 购买完成后自动停止录制")]),t("li",[e._v("✅ 录制数据压缩和上传")])])])])}],ee={name:"RouterIndex"},te=ee,se=(0,l.A)(te,Y,Z,!1,null,"0fd5bf03",null),re=(se.exports,function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("van-nav-bar",{attrs:{title:"手机银行理财产品",fixed:""}}),t("div",{staticClass:"content"},[t("div",{staticClass:"welcome-banner"},[e._m(0),t("div",{staticClass:"banner-image"},[t("van-icon",{attrs:{name:"gold-coin-o",size:"40",color:"#1989fa"}})],1)]),t("div",{staticClass:"main-features"},[t("van-grid",{attrs:{"column-num":2,gutter:16}},[t("van-grid-item",{attrs:{icon:"gold-coin-o",text:"理财产品"},on:{click:function(t){return e.$router.push("/products")}}}),t("van-grid-item",{attrs:{icon:"video-o",text:"录制回放"},on:{click:function(t){return e.$router.push("/player")}}})],1)],1),t("div",{staticClass:"features-section"},[e._m(1),t("van-cell-group",[t("van-cell",{attrs:{title:"完整录制",label:"记录购买和赎回的完整操作流程",icon:"video"}}),t("van-cell",{attrs:{title:"数据压缩",label:"使用pako压缩技术，节省存储空间",icon:"compress"}}),t("van-cell",{attrs:{title:"回放功能",label:"支持操作回放，便于审核和复盘",icon:"play-circle"}}),t("van-cell",{attrs:{title:"安全可靠",label:"数据加密传输，保障操作安全",icon:"shield"}})],1)],1),t("div",{staticClass:"quick-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:function(t){return e.$router.push("/products")}}},[e._v(" 开始体验 ")])],1)])],1)}),ae=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"banner-content"},[t("h2",[e._v("智能录制系统")]),t("p",[e._v("为您的每一笔理财操作提供完整的可回溯记录")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"section-title"},[t("h3",[e._v("功能特色")])])}],oe={name:"Home"},ie=oe,ne=(0,l.A)(ie,re,ae,!1,null,"c1752790",null),le=(ne.exports,function(){var e=this,t=e._self._c;return t("RecordWrapper",{ref:"recordWrapper",attrs:{"show-controls":!1,"auto-start":!1,"stop-on-destroy":!1,"require-consent":!0,metadata:{action:"browse_products"}},on:{"record-started":e.onRecordStarted,"record-declined":e.onRecordDeclined,"record-timeout":e.onRecordTimeout,"timeout-confirmed":e.onTimeoutConfirmed}},[t("div",{staticClass:"product-list"},[t("van-nav-bar",{attrs:{title:"理财产品","left-arrow":"",fixed:""},on:{"click-left":function(t){return e.$router.back()}}}),t("van-dialog",{attrs:{title:"选择购买流程","show-cancel-button":!0,"confirm-button-text":"分步购买流程","cancel-button-text":"传统单页购买","before-close":e.handleModeDialogClose,"close-on-click-overlay":!1},model:{value:e.showModeSelection,callback:function(t){e.showModeSelection=t},expression:"showModeSelection"}},[t("div",{staticClass:"mode-dialog-content"},[t("div",{staticClass:"dialog-icon"},[t("van-icon",{attrs:{name:"shopping-cart-o",size:"48",color:"#1989fa"}})],1),t("p",{staticClass:"dialog-text"},[e._v(" 请选择您喜欢的购买方式： ")]),t("div",{staticClass:"mode-options"},[t("div",{staticClass:"mode-option"},[t("h4",[e._v("📝 分步购买流程")]),t("p",[e._v("• 分步骤引导，操作简单")]),t("p",[e._v("• 支持录制回放")]),t("p",[e._v("• 数据自动保存")])]),t("div",{staticClass:"mode-option"},[t("h4",[e._v("⚡ 传统单页购买")]),t("p",[e._v("• 一页完成所有操作")]),t("p",[e._v("• 快速便捷")]),t("p",[e._v("• 适合熟悉用户")])])])])]),t("div",{staticClass:"content"},[t("div",{staticClass:"stats-card"},[t("div",{staticClass:"stat-item"},[t("div",{staticClass:"stat-number"},[e._v(e._s(e.products.length))]),t("div",{staticClass:"stat-label"},[e._v("在售产品")])]),t("div",{staticClass:"stat-divider"}),t("div",{staticClass:"stat-item"},[t("div",{staticClass:"stat-number"},[e._v("4.2%-9.5%")]),t("div",{staticClass:"stat-label"},[e._v("收益区间")])])]),t("div",{staticClass:"products-container"},e._l(e.products,(function(s){return t("div",{key:s.id,staticClass:"product-card",on:{click:function(t){return e.goToDetail(s.id)}}},[t("div",{staticClass:"product-header"},[t("div",{staticClass:"product-info"},[t("h3",{staticClass:"product-name"},[e._v(e._s(s.name))]),t("p",{staticClass:"product-desc"},[e._v(e._s(s.description))])]),t("div",{staticClass:"product-return"},[t("div",{staticClass:"return-rate"},[e._v(e._s(s.expectedReturn))]),t("div",{staticClass:"return-label"},[e._v("预期收益率")])])]),t("div",{staticClass:"product-details"},[t("div",{staticClass:"detail-item"},[t("span",{staticClass:"detail-label"},[e._v("起购金额")]),t("span",{staticClass:"detail-value"},[e._v(e._s(s.minAmount))])]),t("div",{staticClass:"detail-item"},[t("span",{staticClass:"detail-label"},[e._v("风险等级")]),t("van-tag",{attrs:{type:"低风险"===s.riskLevel?"success":"中风险"===s.riskLevel?"warning":"danger",size:"small"}},[e._v(" "+e._s(s.riskLevel)+" ")])],1)]),t("div",{staticClass:"product-actions"},[t("van-button",{attrs:{size:"small",type:"primary",round:""},on:{click:function(t){return t.stopPropagation(),e.handlePurchaseClick(s.id)}}},[e._v(" 立即购买 ")]),t("van-button",{attrs:{size:"small",plain:"",round:""},on:{click:function(t){return t.stopPropagation(),e.goToRedeem(s.id)}}},[e._v(" 产品赎回 ")])],1)])})),0)])],1)])}),ce=[],de=function(){var e=this,t=e._self._c;return t("div",{staticClass:"record-wrapper"},[t("van-dialog",{attrs:{title:"录制权限申请","show-cancel-button":!0,"confirm-button-text":"同意录制","cancel-button-text":"不同意","before-close":e.handleDialogClose,"close-on-click-overlay":!1},model:{value:e.showRecordDialog,callback:function(t){e.showRecordDialog=t},expression:"showRecordDialog"}},[t("div",{staticClass:"record-dialog-content"},[t("div",{staticClass:"dialog-icon"},[t("van-icon",{attrs:{name:"video-o",size:"48",color:"#1989fa"}})],1),t("p",{staticClass:"dialog-text"},[e._v(" 为了更好地记录您的操作流程，我们需要录制您在此页面的操作行为。 ")]),t("p",{staticClass:"dialog-note"},[e._v(" • 录制仅用于操作流程分析"),t("br"),e._v(" • 录制数据会进行加密处理"),t("br"),e._v(" • 您可以随时停止录制 ")])])]),t("van-dialog",{attrs:{title:"交易超时","show-cancel-button":!1,"confirm-button-text":"确定"},on:{confirm:e.handleTimeout},model:{value:e.showTimeoutDialog,callback:function(t){e.showTimeoutDialog=t},expression:"showTimeoutDialog"}},[t("div",{staticClass:"timeout-dialog-content"},[t("div",{staticClass:"dialog-icon"},[t("van-icon",{attrs:{name:"warning-o",size:"48",color:"#ff6b35"}})],1),t("p",{staticClass:"dialog-text"},[e._v(" 录制时间已超过3分钟，交易失败。请重新开始操作。 ")])])]),e.showIndicator&&e.isRecording?t("div",{staticClass:"record-indicator"},[t("div",{staticClass:"record-dot"}),t("span",[e._v("正在录制 "+e._s(e.recordingTime))])]):e._e(),e.showControls?t("div",{staticClass:"record-controls"},[e.isRecording?t("van-button",{attrs:{type:"danger",size:"small",round:"",loading:e.loading,icon:"pause"},on:{click:e.stopRecord}},[e._v(" 停止录制 ")]):t("van-button",{attrs:{type:"primary",size:"small",round:"",loading:e.loading,icon:"video-o"},on:{click:e.showRecordingConsent}},[e._v(" 开始录制 ")])],1):e._e(),t("div",{staticClass:"content-wrapper"},[e._t("default")],2)],1)},ue=[],pe=s(678),he={name:"RecordWrapper",props:{showIndicator:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0},recordOptions:{type:Object,default:()=>({})},autoStart:{type:Boolean,default:!1},metadata:{type:Object,default:()=>({})},stopOnDestroy:{type:Boolean,default:!1},timeoutDuration:{type:Number,default:18e4},requireConsent:{type:Boolean,default:!0}},data(){return{globalRecorder:null,isRecording:!1,loading:!1,showRecordDialog:!1,showTimeoutDialog:!1,recordingStartTime:null,recordingTimer:null,timeoutTimer:null,recordingTime:"00:00",hasUserConsent:!1}},async mounted(){this.globalRecorder=pe["default"].getInstance(),this.globalRecorder.addListener(this.onRecordEvent);const e=this.globalRecorder.getRecordingStatus();this.isRecording=e.isRecording,this.isRecording&&this.startRecordingTimer(),this.autoStart&&!this.isRecording&&setTimeout((()=>{this.requireConsent&&!this.hasUserConsent?(console.log("RecordWrapper：显示录制同意弹框"),this.showRecordingConsent()):(console.log("RecordWrapper：自动开始录制"),this.startRecord())}),500)},beforeDestroy(){this.clearTimers(),this.globalRecorder&&this.globalRecorder.removeListener(this.onRecordEvent),this.isRecording&&this.stopOnDestroy&&this.stopRecord()},methods:{showRecordingConsent(){this.requireConsent&&!this.isRecording?this.showRecordDialog=!0:this.requireConsent||this.isRecording||this.startRecord()},handleDialogClose(e){this.showRecordDialog=!1,"confirm"===e?(this.hasUserConsent=!0,this.startRecord()):(this.$toast("已取消录制"),this.$emit("record-declined"))},async startRecord(){if(!this.loading&&!this.isRecording){this.loading=!0;try{const e=await this.globalRecorder.startRecording({...this.metadata,component:this.$options.name,route:this.$route.path,startTime:(new Date).toISOString()});e?(this.recordingStartTime=Date.now(),this.startRecordingTimer(),this.startTimeoutTimer(),this.$emit("record-started"),this.$toast.success("开始录制")):this.$toast.fail("录制启动失败")}catch(e){console.error("启动录制失败:",e),this.$toast.fail("录制启动失败")}finally{this.loading=!1}}},async stopRecord(){if(!this.loading&&this.isRecording){this.loading=!0;try{this.clearTimers();const e=await this.globalRecorder.stopRecording();this.$emit("record-stopped",e),e?this.$toast.success("录制已完成"):this.$toast.fail("录制停止失败")}catch(e){console.error("停止录制失败:",e),this.$toast.fail("录制停止失败")}finally{this.loading=!1}}},async stopRecordingAndProcess(e={}){if(this.loading||!this.isRecording)return{success:!1,error:"录制未开始或已停止"};this.loading=!0;try{this.clearTimers();const t=await this.globalRecorder.stopRecordingAndProcess({...e,component:this.$options.name,route:this.$route.path,stopTime:(new Date).toISOString()});if(console.log("RecordWrapper：录制数据处理结果:",t),t.success){const s=await this.uploadVideoData(t.data,e);console.log("RecordWrapper：视频上传结果:",s);const r={success:!0,events:t.recordingResult.events,data:t.data,uploadResult:s,stats:{originalSize:t.data.sizes.original,compressedSize:t.data.sizes.compressed,compressionRatio:t.data.compressionRatio,eventCount:t.data.finalData.totalEvents}};return this.$emit("record-processed",r),this.$toast.success("录制数据处理并上传成功"),r}{console.warn("RecordWrapper：录制数据处理失败:",t.error);const e={success:!1,error:t.error,message:"录制数据为空"===t.error?"请先开始录制，然后进行操作":"录制过程中出现错误"};return this.$emit("record-process-failed",e),this.$toast.fail("录制数据处理失败: "+t.error),e}}catch(t){console.error("RecordWrapper：停止录制并处理数据失败:",t);const e={success:!1,error:t.message};return this.$emit("record-process-failed",e),this.$toast.fail("录制处理失败: "+t.message),e}finally{this.loading=!1}},async uploadVideoData(e,t={}){try{console.log("RecordWrapper：开始上传视频数据...");const s={recordingInfo:{duration:e.duration,eventCount:e.finalData.totalEvents,startTime:e.startTime,endTime:e.endTime,compressionRatio:e.compressionRatio},eventsData:e.finalData.compressedEvents,sizes:e.sizes,businessInfo:{...t,component:this.$options.name,route:this.$route.path,userAgent:navigator.userAgent,timestamp:Date.now()},metadata:{...this.metadata,recordingId:e.recordingId||`rec_${Date.now()}`,version:"1.0"}};console.log("RecordWrapper：准备上传的数据大小:",JSON.stringify(s).length,"字节");const r=await fetch("/api/upload-video-recording",{method:"POST",headers:{"Content-Type":"application/json","X-Recording-Type":"video-session"},body:JSON.stringify(s)});if(!r.ok)throw new Error(`上传请求失败: ${r.status} ${r.statusText}`);const a=await r.json();return console.log("RecordWrapper：视频上传成功:",a),{success:!0,uploadId:a.uploadId||a.id,videoUrl:a.videoUrl||a.url,size:JSON.stringify(s).length,timestamp:Date.now(),response:a}}catch(s){console.error("RecordWrapper：视频上传失败:",s);try{const r=`video_recording_${Date.now()}`,a={...e,additionalInfo:t,uploadFailedAt:(new Date).toISOString(),error:s.message};return localStorage.setItem(r,JSON.stringify(a)),console.log("RecordWrapper：视频数据已保存到本地存储:",r),{success:!1,error:s.message,localStorageKey:r,fallbackStorage:!0,message:"上传失败，数据已保存到本地存储"}}catch(r){return console.error("RecordWrapper：本地存储也失败:",r),{success:!1,error:s.message,localError:r.message,message:"上传失败且本地存储失败"}}}},startRecordingTimer(){this.recordingTimer&&clearInterval(this.recordingTimer),this.recordingTimer=setInterval((()=>{if(this.recordingStartTime){const e=Date.now()-this.recordingStartTime;this.recordingTime=this.formatTime(e)}}),1e3)},startTimeoutTimer(){this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.timeoutTimer=setTimeout((()=>{this.handleRecordingTimeout()}),this.timeoutDuration)},async handleRecordingTimeout(){console.log("录制超时，停止录制"),this.showTimeoutDialog=!0,this.isRecording&&await this.stopRecord(),this.$emit("record-timeout")},handleTimeout(){this.showTimeoutDialog=!1,this.$emit("timeout-confirmed")},clearTimers(){this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null),this.timeoutTimer&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)},formatTime(e){const t=Math.floor(e/1e3),s=Math.floor(t/60),r=t%60;return`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},getRecordingStatus(){return this.globalRecorder?this.globalRecorder.getRecordingStatus():null},onRecordEvent(e,t){switch(e){case"started":this.isRecording=!0;break;case"stopped":this.isRecording=!1,this.clearTimers(),this.recordingTime="00:00";break;case"error":this.isRecording=!1,this.clearTimers(),console.error("录制错误:",t);break}},async finishRecording(e={}){console.log("RecordWrapper：收到完成录制请求，业务数据:",e);try{if(!this.isRecording){console.warn("RecordWrapper：录制未开始，无法完成录制");const e={success:!1,error:"录制未开始",message:"请先开始录制，然后进行操作"};return this.$emit("recording-finished",e),e}const t=await this.globalRecorder.finishRecording(e);return console.log("RecordWrapper：录制完成结果:",t),this.$emit("recording-finished",t),t}catch(t){console.error("RecordWrapper：完成录制失败:",t);const e={success:!1,error:t.message,message:"录制完成处理失败"};return this.$emit("recording-finished",e),e}}}},me=he,ge=(0,l.A)(me,de,ue,!1,null,"5cf00da6",null),ve=ge.exports,ye={name:"ProductList",components:{RecordWrapper:ve},data(){return{showModeSelection:!1,selectedProductId:null,preferredPurchaseMode:"step",products:[{id:1,name:"稳健增长理财产品",description:"低风险，稳定收益，适合保守型投资者",expectedReturn:"4.2%",minAmount:"1000元",riskLevel:"低风险",image:"https://img.yzcdn.cn/vant/cat.jpeg"},{id:2,name:"平衡配置理财产品",description:"中等风险，均衡收益，适合稳健型投资者",expectedReturn:"6.8%",minAmount:"5000元",riskLevel:"中风险",image:"https://img.yzcdn.cn/vant/cat.jpeg"},{id:3,name:"成长机会理财产品",description:"高风险高收益，适合积极型投资者",expectedReturn:"9.5%",minAmount:"10000元",riskLevel:"高风险",image:"https://img.yzcdn.cn/vant/cat.jpeg"}]}},methods:{goToDetail(e){this.$router.push(`/product/${e}`)},handlePurchaseClick(e){this.selectedProductId=e,this.checkRecordingStatus().then((t=>{t?this.goToPurchase(e,"step"):this.triggerRecordingConsent()}))},triggerRecordingConsent(){this.$refs.recordWrapper?.showRecordingConsent()},async checkRecordingStatus(){try{const e=(await Promise.resolve().then(s.bind(s,678))).default,t=e.getInstance(),r=t.getRecordingStatus();return r.isRecording}catch(e){return console.error("检查录制状态失败:",e),!1}},handleModeDialogClose(e){this.showModeSelection=!1,"confirm"===e?this.selectPurchaseMode("step"):"cancel"===e&&this.selectPurchaseMode("single")},selectPurchaseMode(e){this.preferredPurchaseMode=e,this.goToPurchase(this.selectedProductId,e)},goToPurchase(e,t="step"){"step"===t?this.$router.push({name:"PurchaseStepOne",query:{id:e}}):this.$router.push(`/purchase/${e}`)},goToRedeem(e){this.$router.push(`/redeem/${e}`)},onRecordStarted(){console.log("产品列表：录制开始"),this.$toast.success("录制已开始，现在可以进行购买操作"),this.selectedProductId&&this.goToPurchase(this.selectedProductId,"step")},onRecordDeclined(){console.log("产品列表：用户拒绝录制"),this.$toast("已取消录制，将使用传统购买流程"),this.selectedProductId&&this.goToPurchase(this.selectedProductId,"single")},onRecordTimeout(){console.log("产品列表：录制超时"),this.$toast.fail("录制超时，交易已取消"),this.showModeSelection=!1},onTimeoutConfirmed(){console.log("产品列表：超时确认"),this.showModeSelection=!1}}},fe=ye,Re=(0,l.A)(fe,le,ce,!1,null,"624eb8e7",null),be=Re.exports,we=function(){var e=this,t=e._self._c;return t("div",{staticClass:"product-detail"},[t("van-nav-bar",{attrs:{title:"产品详情","left-arrow":""},on:{"click-left":function(t){return e.$router.back()}}}),e.product?t("div",{staticClass:"content"},[t("van-card",{attrs:{title:e.product.name,desc:e.product.description,price:e.product.expectedReturn,thumb:e.product.image},scopedSlots:e._u([{key:"tags",fn:function(){return[t("van-tag",{attrs:{type:"低风险"===e.product.riskLevel?"success":"中风险"===e.product.riskLevel?"warning":"danger"}},[e._v(" "+e._s(e.product.riskLevel)+" ")])]},proxy:!0}],null,!1,269412469)}),t("van-cell-group",{attrs:{title:"产品信息"}},[t("van-cell",{attrs:{title:"预期收益率",value:e.product.expectedReturn}}),t("van-cell",{attrs:{title:"起购金额",value:e.product.minAmount}}),t("van-cell",{attrs:{title:"产品期限",value:e.product.term}}),t("van-cell",{attrs:{title:"风险等级",value:e.product.riskLevel}}),t("van-cell",{attrs:{title:"投资方向",value:e.product.investmentDirection}})],1),t("van-cell-group",{attrs:{title:"产品特色"}},e._l(e.product.features,(function(e,s){return t("van-cell",{key:s,attrs:{title:e}})})),1),t("div",{staticClass:"actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:""},on:{click:e.goToPurchase}},[e._v(" 立即购买 ")]),t("van-button",{staticStyle:{"margin-top":"12px"},attrs:{size:"large",block:""},on:{click:e.goToRedeem}},[e._v(" 产品赎回 ")])],1)],1):e._e()],1)},Ce=[],_e={name:"ProductDetail",data(){return{product:null,products:{1:{id:1,name:"稳健增长理财产品",description:"低风险，稳定收益，适合保守型投资者",expectedReturn:"4.2%",minAmount:"1000元",term:"90天",riskLevel:"低风险",investmentDirection:"货币市场工具、债券",image:"https://img.yzcdn.cn/vant/cat.jpeg",features:["本金安全保障","收益稳定可预期","流动性较好","适合保守投资者"]},2:{id:2,name:"平衡配置理财产品",description:"中等风险，均衡收益，适合稳健型投资者",expectedReturn:"6.8%",minAmount:"5000元",term:"180天",riskLevel:"中风险",investmentDirection:"债券、股票、基金",image:"https://img.yzcdn.cn/vant/cat.jpeg",features:["风险收益平衡","投资组合多样化","专业团队管理","适合稳健投资者"]},3:{id:3,name:"成长机会理财产品",description:"高风险高收益，适合积极型投资者",expectedReturn:"9.5%",minAmount:"10000元",term:"365天",riskLevel:"高风险",investmentDirection:"股票、期货、股权投资",image:"https://img.yzcdn.cn/vant/cat.jpeg",features:["高收益潜力","成长性投资机会","风险控制机制","适合积极投资者"]}}}},created(){this.loadProduct()},methods:{loadProduct(){const e=parseInt(this.$route.params.id);this.product=this.products[e]},goToPurchase(){this.$router.push(`/purchase/${this.product.id}`)},goToRedeem(){this.$router.push(`/redeem/${this.product.id}`)}},watch:{$route(){this.loadProduct()}}},ke=_e,$e=(0,l.A)(ke,we,Ce,!1,null,"abe6d008",null),Pe=($e.exports,function(){var e=this,t=e._self._c;return t("RecordWrapper",{attrs:{"auto-start":!1,"show-controls":!1,"stop-on-destroy":!0,metadata:{action:"purchase",productId:e.productId}},on:{"record-started":e.onRecordStarted,"record-stopped":e.onRecordStopped}},[t("div",{staticClass:"purchase"},[t("van-nav-bar",{attrs:{title:"产品购买","left-arrow":"",fixed:""},on:{"click-left":function(t){return e.$router.back()}}}),e.product?t("div",{staticClass:"content"},[t("div",{staticClass:"product-info-card"},[t("div",{staticClass:"product-header"},[t("h3",{staticClass:"product-name"},[e._v(e._s(e.product.name))]),t("div",{staticClass:"product-return"},[e._v(e._s(e.product.expectedReturn))])]),t("p",{staticClass:"product-desc"},[e._v(e._s(e.product.description))])]),t("div",{staticClass:"steps-container"},[t("van-steps",{attrs:{active:e.currentStep,direction:"horizontal"}},[t("van-step",[e._v("确认产品")]),t("van-step",[e._v("填写信息")]),t("van-step",[e._v("确认购买")]),t("van-step",[e._v("购买完成")])],1)],1),t("div",{staticClass:"step-content"},[0===e.currentStep?t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("产品确认")]),t("van-cell-group",[t("van-cell",{attrs:{title:"产品名称",value:e.product.name}}),t("van-cell",{attrs:{title:"预期收益率",value:e.product.expectedReturn}}),t("van-cell",{attrs:{title:"起购金额",value:e.product.minAmount}}),t("van-cell",{attrs:{title:"产品期限",value:e.product.term}})],1),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.nextStep}},[e._v(" 确认产品信息 ")])],1)],1):e._e(),1===e.currentStep?t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("填写购买信息")]),t("van-form",{ref:"purchaseForm",on:{submit:e.onFormSubmit}},[t("van-field",{attrs:{name:"amount",label:"购买金额",placeholder:"请输入购买金额",type:"number",rules:[{required:!0,message:"请填写购买金额"}]},model:{value:e.purchaseForm.amount,callback:function(t){e.$set(e.purchaseForm,"amount",t)},expression:"purchaseForm.amount"}}),t("van-field",{attrs:{name:"bankCard",label:"银行卡号",placeholder:"请输入银行卡号",rules:[{required:!0,message:"请填写银行卡号"}]},model:{value:e.purchaseForm.bankCard,callback:function(t){e.$set(e.purchaseForm,"bankCard",t)},expression:"purchaseForm.bankCard"}}),t("van-field",{attrs:{name:"password",label:"交易密码",placeholder:"请输入交易密码",type:"password",rules:[{required:!0,message:"请填写交易密码"}]},model:{value:e.purchaseForm.password,callback:function(t){e.$set(e.purchaseForm,"password",t)},expression:"purchaseForm.password"}}),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.validateAndNext}},[e._v(" 下一步 ")])],1)],1)],1):e._e(),2===e.currentStep?t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("确认购买信息")]),t("van-cell-group",[t("van-cell",{attrs:{title:"产品名称",value:e.product.name}}),t("van-cell",{attrs:{title:"购买金额",value:`¥${e.purchaseForm.amount}`}}),t("van-cell",{attrs:{title:"预期收益",value:e.expectedProfit}}),t("van-cell",{attrs:{title:"银行卡号",value:e.maskedBankCard}})],1),t("div",{staticClass:"risk-notice"},[t("van-notice-bar",{attrs:{"left-icon":"warning-o",text:"投资有风险，理财产品不保证本金和收益，过往业绩不代表未来表现"}})],1),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:"",loading:e.purchasing},on:{click:e.confirmPurchase}},[e._v(" 确认购买 ")])],1)],1):e._e(),3===e.currentStep?t("div",{staticClass:"step-card success-card"},[t("div",{staticClass:"success-content"},[t("van-icon",{attrs:{name:"success",size:"50",color:"#07c160"}}),t("h3",[e._v("购买成功！")]),t("p",[e._v("您已成功购买理财产品")]),t("van-cell-group",[t("van-cell",{attrs:{title:"订单号",value:e.orderNo}}),t("van-cell",{attrs:{title:"购买时间",value:e.purchaseTime}}),t("van-cell",{attrs:{title:"购买金额",value:`¥${e.purchaseForm.amount}`}}),t("van-cell",{attrs:{title:"预期收益",value:e.expectedProfit}}),e.recordingResult?t("van-cell",{attrs:{title:"录制状态",value:e.recordingResult.success?"录制完成":"录制失败"}}):e._e(),e.recordingResult&&e.recordingResult.dataSize?t("van-cell",{attrs:{title:"录制数据大小",value:e.recordingResult.dataSize}}):e._e(),e.recordingResult&&e.recordingResult.compressionRatio?t("van-cell",{attrs:{title:"压缩率",value:e.recordingResult.compressionRatio}}):e._e()],1),e.recordingResult&&e.recordingResult.success&&e.recordingResult.events?t("div",{staticClass:"replay-section"},[t("h4",[e._v("购买流程回放")]),t("div",{staticClass:"replay-controls"},[t("van-button",{attrs:{type:"primary",size:"small",disabled:e.isReplaying},on:{click:e.startReplay}},[e._v(" "+e._s(e.isReplaying?"正在回放...":"开始回放")+" ")]),e.isReplaying?t("van-button",{attrs:{size:"small"},on:{click:e.stopReplay}},[e._v(" 停止回放 ")]):e._e()],1),t("div",{staticClass:"replay-container",attrs:{id:"replay-container"}})]):e._e(),e.recordingResult&&e.recordingResult.success?t("div",{staticClass:"recording-success-section"},[t("h4",[e._v("录制状态")]),t("van-notice-bar",{attrs:{type:"success",text:"录制数据处理并上传成功"}}),t("div",{staticClass:"success-info",staticStyle:{"margin-top":"12px"}},[t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("事件数量:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.recordingResult?e.recordingResult.recordingResult.eventCount:e.recordingResult.data?e.recordingResult.data.finalData.totalEvents:0))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("原始大小:")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatFileSize(e.recordingResult.stats.originalSize)))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("压缩大小:")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatFileSize(e.recordingResult.stats.compressedSize)))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("压缩率:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.stats.compressionRatio))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("上传状态:")]),t("van-tag",{attrs:{type:e.recordingResult.uploadResult.success?"success":"danger"}},[e._v(" "+e._s(e.recordingResult.uploadResult.success?"成功":"失败")+" ")])],1),e.recordingResult.uploadResult.success?t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("上传ID:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.uploadResult.uploadId))])]):e._e()]),t("div",{staticClass:"upload-details",staticStyle:{"margin-top":"16px"}},[t("h4",{staticStyle:{"font-size":"14px","margin-bottom":"8px"}},[e._v("上传结果详情:")]),t("div",{staticClass:"upload-result",staticStyle:{background:"#f7f8fa",padding:"12px","border-radius":"4px","font-size":"12px","overflow-x":"auto"}},[t("pre",{staticStyle:{margin:"0","white-space":"pre-wrap","word-break":"break-all"}},[e._v(e._s(JSON.stringify(e.recordingResult.uploadResult,null,2)))])])])],1):e.recordingResult&&!e.recordingResult.success?t("div",{staticClass:"recording-error-section"},[t("h4",[e._v("录制状态")]),t("van-notice-bar",{attrs:{type:"danger",text:e.recordingResult.message||e.recordingResult.error||"录制失败"}}),t("div",{staticClass:"error-suggestion",staticStyle:{"margin-top":"12px",padding:"12px",background:"#fff2f0","border-radius":"4px"}},[t("p",{staticStyle:{margin:"0",color:"#ff4757","font-size":"14px"}},[t("van-icon",{staticStyle:{"margin-right":"4px"},attrs:{name:"info-o"}}),e._v(" 建议操作流程： ")],1),t("ol",{staticStyle:{margin:"8px 0 0 20px",color:"#666","font-size":"13px"}},[t("li",[e._v("返回产品列表页面")]),t("li",[e._v('点击"开始录制"按钮')]),t("li",[e._v("再次进行购买操作")])])])],1):t("div",{staticClass:"no-recording-section"},[t("h4",[e._v("录制状态")]),t("van-notice-bar",{attrs:{type:"warning",text:"没有录制数据，请确保在操作前已开始录制"}})],1),t("div",{staticClass:"step-actions"},[e.recordingResult&&e.recordingResult.success?t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.goHome}},[e._v(" 返回首页 ")]):[t("van-button",{staticStyle:{"margin-bottom":"12px"},attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.goToProducts}},[e._v(" 重新开始录制 ")]),t("van-button",{attrs:{type:"default",size:"large",block:"",round:""},on:{click:e.goHome}},[e._v(" 返回首页 ")])]],2)],1)]):e._e()])]):e._e()],1)])}),xe=[],Se={name:"Purchase",components:{RecordWrapper:ve},data(){return{productId:null,product:null,currentStep:0,purchasing:!1,purchaseForm:{amount:"",bankCard:"",password:""},orderNo:"",purchaseTime:"",recordingResult:null,isReplaying:!1,replayPlayer:null,replayerObserver:null,products:{1:{id:1,name:"稳健增长理财产品",description:"低风险，稳定收益，适合保守型投资者",expectedReturn:"4.2%",minAmount:"1000元",term:"90天",image:"https://img.yzcdn.cn/vant/cat.jpeg"},2:{id:2,name:"平衡配置理财产品",description:"中等风险，均衡收益，适合稳健型投资者",expectedReturn:"6.8%",minAmount:"5000元",term:"180天",image:"https://img.yzcdn.cn/vant/cat.jpeg"},3:{id:3,name:"成长机会理财产品",description:"高风险高收益，适合积极型投资者",expectedReturn:"9.5%",minAmount:"10000元",term:"365天",image:"https://img.yzcdn.cn/vant/cat.jpeg"}}}},computed:{expectedProfit(){if(!this.purchaseForm.amount||!this.product)return"¥0";const e=parseFloat(this.product.expectedReturn)/100,t=this.purchaseForm.amount*e;return`¥${t.toFixed(2)}`},maskedBankCard(){if(!this.purchaseForm.bankCard)return"";const e=this.purchaseForm.bankCard;return e.replace(/(\d{4})\d+(\d{4})/,"$1****$2")}},created(){this.loadProduct()},methods:{async finishRecordingWithWrapper(){try{console.log("购买页面：调用RecordWrapper完成录制...");let e=null;if(this.$parent&&"RecordWrapper"===this.$parent.$options.name)e=this.$parent;else{const t=e=>{if("RecordWrapper"===e.$options.name)return e;for(let s of e.$children||[]){const e=t(s);if(e)return e}return null};e=t(this.$root)}if(e&&"function"===typeof e.finishRecording){const t=await e.finishRecording({purchaseInfo:{productId:this.productId,productName:this.product.name,amount:this.purchaseForm.amount,bankCard:this.maskedBankCard,orderNo:this.orderNo,timestamp:Date.now(),page:"Purchase"}});console.log("购买页面：录制完成结果:",t),this.recordingResult=t}else console.warn("未找到RecordWrapper组件或finishRecording方法"),this.recordingResult={success:!1,error:"未找到录制组件",message:"录制组件不可用"},this.$toast.fail("录制组件不可用")}catch(e){console.error("购买页面：调用录制完成失败:",e),this.recordingResult={success:!1,error:e.message,message:"录制完成失败"},this.$toast.fail("录制完成失败: "+e.message)}},loadProduct(){this.productId=parseInt(this.$route.params.id),this.product=this.products[this.productId]},nextStep(){this.currentStep<3&&this.currentStep++},validateAndNext(){if(!this.purchaseForm.amount)return void this.$toast.fail("请填写购买金额");if(!this.purchaseForm.bankCard)return void this.$toast.fail("请填写银行卡号");if(!this.purchaseForm.password)return void this.$toast.fail("请填写交易密码");const e=parseInt(this.product.minAmount.replace(/[^\d]/g,""));parseInt(this.purchaseForm.amount)<e?this.$toast.fail(`购买金额不能少于${this.product.minAmount}`):this.purchaseForm.bankCard.length<16?this.$toast.fail("请输入正确的银行卡号"):this.purchaseForm.password.length<6?this.$toast.fail("交易密码至少6位数"):this.nextStep()},onFormSubmit(){this.nextStep()},async confirmPurchase(){try{const e=(await Promise.resolve().then(s.bind(s,678))).default,t=e.getInstance(),r=t.getRecordingStatus();if(!r.isRecording)return void this.$toast.fail("请先在产品列表页开始录制")}catch(e){return console.error("检查录制状态失败:",e),void this.$toast.fail("录制状态检查失败")}this.purchasing=!0;try{await new Promise((e=>setTimeout(e,2e3))),this.orderNo="PO"+Date.now(),this.purchaseTime=(new Date).toLocaleString(),this.purchasing=!1,this.nextStep(),setTimeout((async()=>{console.log("购买成功页面已显示，开始停止录制...");const e=(await Promise.resolve().then(s.bind(s,678))).default,t=e.getInstance(),r=t.getRecordingStatus();if(console.log("当前录制状态:",r),r.isRecording)try{await this.finishRecordingWithWrapper()}finally{}else console.warn("录制已停止，可能在购买过程中被中断"),this.recordingResult={success:!1,error:"录制在购买过程中被中断",message:"录制状态异常，请重新开始录制流程"},this.$toast.fail("录制状态异常")}),1500)}catch(e){console.error("购买流程出错:",e),this.purchasing=!1,this.$toast.fail("购买失败，请重试")}},formatFileSize(e){if(0===e)return"0 B";const t=1024,s=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+s[r]},async startReplay(){if(this.recordingResult&&this.recordingResult.events)try{this.isReplaying=!0;const e=document.getElementById("replay-container");if(!e)throw new Error("回放容器未找到");e.innerHTML="",e.style.width="100%",e.style.height="600px",e.style.position="relative",e.style.overflow="visible",e.style.border="1px solid #eee",e.style.borderRadius="4px",e.style.backgroundColor="#f5f5f5",console.log("Purchase页面：开始回放，事件数量:",this.recordingResult.events.length),console.log("Purchase页面：前几个事件:",this.recordingResult.events.slice(0,3));const t=this.recordingResult.events;if(!Array.isArray(t)||t.length<2)throw new Error("录制数据格式不正确或事件太少");const s=t.some((e=>4===e.type)),r=t.some((e=>2===e.type));if(!s||!r)throw new Error("录制数据缺少必要的元信息或快照");if("undefined"===typeof window.rrwebPlayer)throw new Error("rrweb-player库未找到，请确保已正确引入");const a=window.rrwebPlayer;console.log("Purchase页面：创建rrweb-player"),this.replayPlayer=new a({target:e,props:{events:t,width:e.offsetWidth||375,height:550,autoPlay:!1,showController:!0,showWarning:!1,showDebug:!1,speed:1,speedOption:[.5,1,1.5,2,4],skipInactive:!1,mouseTail:!1,tags:{"virtual-styles":{}}}}),console.log("Purchase页面：rrweb-player创建成功"),setTimeout((()=>{const t=e.querySelectorAll("iframe");t.forEach((e=>{e.hasAttribute("sandbox")&&e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-modals"),e.style.width="100%",e.style.height="100%",e.style.border="none"})),console.log("Purchase页面：已完成回放器初始化")}),500),this.replayPlayer&&this.replayPlayer.$on&&(this.replayPlayer.$on("finish",(()=>{this.isReplaying=!1,console.log("Purchase页面：回放完成")})),this.replayPlayer.$on("start",(()=>{console.log("Purchase页面：回放开始")}))),this.$toast.success("开始回放购买流程")}catch(e){console.error("Purchase页面：回放失败:",e),this.isReplaying=!1,this.$toast.fail("回放失败: "+e.message);const t=document.getElementById("replay-container");t&&(t.innerHTML=`\n            <div style="text-align: center; padding: 50px; color: #f56c6c; background: white;">\n              <h4>回放失败</h4>\n              <p style="font-size: 12px; margin-top: 10px;">${e.message}</p>\n              <p style="font-size: 10px; color: #999; margin-top: 10px;">\n                事件数量: ${this.recordingResult.events?this.recordingResult.events.length:0}\n              </p>\n            </div>\n          `)}else this.$toast.fail("没有录制数据可回放")},setupReplayerObserver(e,t){console.log("Purchase页面：设置DOM监听器"),this.replayerObserver&&this.replayerObserver.disconnect(),this.replayerObserver=new MutationObserver((s=>{let r=!1;s.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{if(1===e.nodeType){const t=e.className||"",s=e.tagName||"";(t.includes("replayer")||t.includes("rr-")||"IFRAME"===s||e.querySelector&&(e.querySelector(".replayer-wrapper")||e.querySelector(".rr-player")||e.querySelector('[class*="rr-"]')))&&(console.log("DOM监听器：发现新的回放器元素",s,t),r=!0)}}))})),r&&setTimeout((()=>{this.forceFixReplayerPosition(e,t)}),100)})),this.replayerObserver.observe(document.body,{childList:!0,subtree:!0})},forceFixReplayerPosition(e,t){console.log("Purchase页面：开始强制修复回放器位置");const s=document.querySelectorAll('\n        .replayer-wrapper,\n        .rr-player,\n        [class*="rr-"],\n        [class*="replayer"],\n        iframe[src*="blob:"]\n      ');console.log("找到的回放器相关元素数量:",s.length);let r=!1;s.forEach(((s,a)=>{if(console.log(`元素 ${a}:`,s.tagName,s.className,"父元素:",s.parentElement?.className),e.contains(s)){if(!t.contains(s)&&s!==t){console.log("将元素移动到wrapper内:",s.className||s.tagName);try{t.appendChild(s),this.fixReplayerPosition(s,t),r=!0}catch(o){console.error("移动到wrapper失败:",o)}}}else{console.log("移动元素到容器内:",s.className||s.tagName);try{t.appendChild(s),this.fixReplayerPosition(s,t),r=!0}catch(o){console.error("移动元素失败:",o)}}}));const a=Array.from(document.body.children);a.forEach((e=>{if(e.className&&(e.className.includes("replayer")||e.className.includes("rr-")||"IFRAME"===e.tagName)){console.log("发现body下的回放器元素:",e.className||e.tagName);try{t.appendChild(e),this.fixReplayerPosition(e,t),r=!0}catch(s){console.error("从body移动元素失败:",s)}}})),r?(console.log("Purchase页面：已移动回放器元素到正确位置"),console.log("最终容器结构:",e.innerHTML.substring(0,300))):console.log("Purchase页面：未发现需要移动的回放器元素")},fixReplayerPosition(e,t){if(!e||!t)return;console.log("修复回放器元素:",e.tagName,e.className),e.style.position="relative",e.style.width="100%",e.style.height="400px",e.style.border="none",e.style.background="#fff",e.style.left="0",e.style.top="0",e.style.transform="none",e.style.margin="0",e.style.padding="0",e.style.display="block",e.style.visibility="visible",e.style.opacity="1";const s=e.querySelector("iframe");s&&(console.log("修复iframe:",s.src?s.src.substring(0,50):"no src"),s.style.width="100%",s.style.height="100%",s.style.border="none",s.style.display="block",s.style.visibility="visible",s.style.opacity="1",s.hasAttribute("sandbox")&&(console.log("修复iframe sandbox权限"),s.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-modals")));const r=e.querySelectorAll("video, canvas");r.forEach((e=>{console.log("修复视频/canvas元素:",e.tagName),e.style.display="block",e.style.visibility="visible",e.style.opacity="1",e.style.width="100%",e.style.height="auto"}));const a=e.querySelector(".rr-controller");a&&(a.style.position="absolute",a.style.bottom="0",a.style.left="0",a.style.right="0",a.style.height="auto",a.style.zIndex="10",a.style.display="block",a.style.visibility="visible"),console.log("已修复回放器位置和可见性:",e.className)},debugReplayerStructure(e){console.log("=== 回放器DOM结构调试 ==="),console.log("容器:",e.id,e.className),console.log("容器内容:",e.innerHTML.length,"字符");const t=Array.from(e.children);t.forEach(((e,t)=>{console.log(`子元素 ${t}:`,e.tagName,e.className,{display:e.style.display||getComputedStyle(e).display,visibility:e.style.visibility||getComputedStyle(e).visibility,opacity:e.style.opacity||getComputedStyle(e).opacity,width:e.offsetWidth,height:e.offsetHeight});const s=e.querySelector("iframe");s&&console.log("  -> iframe:",{src:s.src?s.src.substring(0,50)+"...":"no src",display:s.style.display||getComputedStyle(s).display,visibility:s.style.visibility||getComputedStyle(s).visibility,width:s.offsetWidth,height:s.offsetHeight,loaded:s.contentDocument?"yes":"no"});const r=e.querySelectorAll("video, canvas");r.forEach(((e,t)=>{console.log(`  -> ${e.tagName} ${t}:`,{display:e.style.display||getComputedStyle(e).display,width:e.offsetWidth,height:e.offsetHeight})}))})),console.log("=== 调试结束 ===")},stopReplay(){if(this.replayPlayer)try{this.replayPlayer.$destroy&&this.replayPlayer.$destroy(),this.replayPlayer=null}catch(t){console.error("停止回放失败:",t)}this.isReplaying=!1;const e=document.getElementById("replay-container");e&&(e.innerHTML='<div style="text-align: center; padding: 50px; color: #999;">回放已停止</div>')},goToProducts(){this.stopReplay(),this.$router.push("/products")},goHome(){this.stopReplay(),this.$router.push("/")},onRecordStarted(){console.log("购买流程录制开始"),this.$toast.success("开始录制购买流程")},onRecordStopped(e){console.log("购买流程录制完成:",e),this.$toast.success("购买流程录制完成")}},beforeDestroy(){this.stopReplay()}},Te=Se,Fe=(0,l.A)(Te,Pe,xe,!1,null,"510dfe0e",null),ze=(Fe.exports,function(){var e=this,t=e._self._c;return t("RecordWrapper",{attrs:{"auto-start":!1,"show-controls":!1,"stop-on-destroy":!0,metadata:{action:"redeem",productId:e.productId}},on:{"record-started":e.onRecordStarted,"record-stopped":e.onRecordStopped}},[t("div",{staticClass:"redeem"},[t("van-nav-bar",{attrs:{title:"产品赎回","left-arrow":"",fixed:""},on:{"click-left":function(t){return e.$router.back()}}}),e.product?t("div",{staticClass:"content"},[t("div",{staticClass:"product-info-card"},[t("div",{staticClass:"product-header"},[t("h3",{staticClass:"product-name"},[e._v(e._s(e.product.name))]),t("div",{staticClass:"product-return"},[e._v(e._s(e.product.expectedReturn))])]),t("p",{staticClass:"product-desc"},[e._v(e._s(e.product.description))])]),t("div",{staticClass:"steps-container"},[t("van-steps",{attrs:{active:e.currentStep,direction:"horizontal"}},[t("van-step",[e._v("选择产品")]),t("van-step",[e._v("填写信息")]),t("van-step",[e._v("确认赎回")]),t("van-step",[e._v("赎回完成")])],1)],1),t("div",{staticClass:"step-content"},[0===e.currentStep?t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("持有产品")]),t("van-cell-group",[t("van-cell",{attrs:{title:"产品名称",value:e.product.name}}),t("van-cell",{attrs:{title:"持有金额",value:"¥50,000"}}),t("van-cell",{attrs:{title:"累计收益",value:"¥2,100"}}),t("van-cell",{attrs:{title:"持有天数",value:"45天"}})],1),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.nextStep}},[e._v(" 选择此产品赎回 ")])],1)],1):e._e(),1===e.currentStep?t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("填写赎回信息")]),t("van-form",{ref:"redeemForm",on:{submit:e.onFormSubmit}},[t("van-field",{attrs:{name:"redeemType",label:"赎回类型",placeholder:"请选择赎回类型",readonly:"",rules:[{required:!0,message:"请选择赎回类型"}]},on:{click:function(t){e.showRedeemTypePicker=!0}},model:{value:e.redeemForm.redeemType,callback:function(t){e.$set(e.redeemForm,"redeemType",t)},expression:"redeemForm.redeemType"}}),t("van-field",{attrs:{name:"amount",label:"赎回金额",placeholder:"请输入赎回金额",type:"number",rules:[{required:!0,message:"请填写赎回金额"}]},model:{value:e.redeemForm.amount,callback:function(t){e.$set(e.redeemForm,"amount",t)},expression:"redeemForm.amount"}}),t("van-field",{attrs:{name:"bankCard",label:"收款银行卡",placeholder:"请输入收款银行卡号",rules:[{required:!0,message:"请填写银行卡号"}]},model:{value:e.redeemForm.bankCard,callback:function(t){e.$set(e.redeemForm,"bankCard",t)},expression:"redeemForm.bankCard"}}),t("van-field",{attrs:{name:"password",label:"交易密码",placeholder:"请输入交易密码",type:"password",rules:[{required:!0,message:"请填写交易密码"}]},model:{value:e.redeemForm.password,callback:function(t){e.$set(e.redeemForm,"password",t)},expression:"redeemForm.password"}}),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.validateAndNext}},[e._v(" 下一步 ")])],1)],1)],1):e._e(),2===e.currentStep?t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("确认赎回信息")]),t("van-cell-group",[t("van-cell",{attrs:{title:"产品名称",value:e.product.name}}),t("van-cell",{attrs:{title:"赎回类型",value:e.redeemForm.redeemType}}),t("van-cell",{attrs:{title:"赎回金额",value:`¥${e.redeemForm.amount}`}}),t("van-cell",{attrs:{title:"预计到账",value:e.expectedArrival}}),t("van-cell",{attrs:{title:"收款银行卡",value:e.maskedBankCard}})],1),t("div",{staticClass:"notice-section"},[t("van-notice-bar",{attrs:{"left-icon":"info-o",text:"到账时间：T+1个工作日到账，本产品赎回免手续费"}})],1),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:"",loading:e.redeeming},on:{click:e.confirmRedeem}},[e._v(" 确认赎回 ")])],1)],1):e._e(),3===e.currentStep?t("div",{staticClass:"step-card success-card"},[t("div",{staticClass:"success-content"},[t("van-icon",{attrs:{name:"success",size:"50",color:"#07c160"}}),t("h3",[e._v("赎回申请成功！")]),t("p",[e._v("您的赎回申请已提交，资金将在T+1个工作日到账")]),t("van-cell-group",[t("van-cell",{attrs:{title:"赎回单号",value:e.redeemNo}}),t("van-cell",{attrs:{title:"申请时间",value:e.redeemTime}}),t("van-cell",{attrs:{title:"赎回金额",value:`¥${e.redeemForm.amount}`}}),t("van-cell",{attrs:{title:"预计到账",value:e.expectedArrival}}),e.recordingResult?t("van-cell",{attrs:{title:"录制状态",value:e.recordingResult.success?"录制完成":"录制失败"}}):e._e(),e.recordingResult&&e.recordingResult.dataSize?t("van-cell",{attrs:{title:"录制数据大小",value:e.recordingResult.dataSize}}):e._e(),e.recordingResult&&e.recordingResult.compressionRatio?t("van-cell",{attrs:{title:"压缩率",value:e.recordingResult.compressionRatio}}):e._e()],1),e.recordingResult&&e.recordingResult.success&&e.recordingResult.events?t("div",{staticClass:"replay-section"},[t("h4",[e._v("赎回流程回放")]),t("div",{staticClass:"replay-controls"},[t("van-button",{attrs:{type:"primary",size:"small",disabled:e.isReplaying},on:{click:e.startReplay}},[e._v(" "+e._s(e.isReplaying?"正在回放...":"开始回放")+" ")]),e.isReplaying?t("van-button",{attrs:{size:"small"},on:{click:e.stopReplay}},[e._v(" 停止回放 ")]):e._e()],1),t("div",{staticClass:"replay-container",staticStyle:{border:"1px solid #eee",background:"#f5f5f5","min-height":"300px","margin-top":"12px"},attrs:{id:"redeem-replay-container"}})]):e._e(),e.recordingResult&&e.recordingResult.success?t("div",{staticClass:"recording-success-section"},[t("h4",[e._v("录制状态")]),t("van-notice-bar",{attrs:{type:"success",text:"录制数据处理并上传成功"}}),t("div",{staticClass:"success-info",staticStyle:{"margin-top":"12px"}},[t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("事件数量:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.recordingResult?e.recordingResult.recordingResult.eventCount:e.recordingResult.data?e.recordingResult.data.finalData.totalEvents:0))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("原始大小:")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatFileSize(e.recordingResult.stats.originalSize)))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("压缩大小:")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatFileSize(e.recordingResult.stats.compressedSize)))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("压缩率:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.stats.compressionRatio))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("上传状态:")]),t("van-tag",{attrs:{type:e.recordingResult.uploadResult.success?"success":"danger"}},[e._v(" "+e._s(e.recordingResult.uploadResult.success?"成功":"失败")+" ")])],1),e.recordingResult.uploadResult.success?t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("上传ID:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.uploadResult.uploadId))])]):e._e()]),t("div",{staticClass:"upload-details",staticStyle:{"margin-top":"16px"}},[t("h4",{staticStyle:{"font-size":"14px","margin-bottom":"8px"}},[e._v("上传结果详情:")]),t("div",{staticClass:"upload-result",staticStyle:{background:"#f7f8fa",padding:"12px","border-radius":"4px","font-size":"12px","overflow-x":"auto"}},[t("pre",{staticStyle:{margin:"0","white-space":"pre-wrap","word-break":"break-all"}},[e._v(e._s(JSON.stringify(e.recordingResult.uploadResult,null,2)))])])])],1):e.recordingResult&&!e.recordingResult.success?t("div",{staticClass:"recording-error-section"},[t("h4",[e._v("录制状态")]),t("van-notice-bar",{attrs:{type:"danger",text:e.recordingResult.message||e.recordingResult.error||"录制失败"}}),t("div",{staticClass:"error-suggestion",staticStyle:{"margin-top":"12px",padding:"12px",background:"#fff2f0","border-radius":"4px"}},[t("p",{staticStyle:{margin:"0",color:"#ff4757","font-size":"14px"}},[t("van-icon",{staticStyle:{"margin-right":"4px"},attrs:{name:"info-o"}}),e._v(" 建议操作流程： ")],1),t("ol",{staticStyle:{margin:"8px 0 0 20px",color:"#666","font-size":"13px"}},[t("li",[e._v("返回产品列表页面")]),t("li",[e._v('点击"开始录制"按钮')]),t("li",[e._v("再次进行赎回操作")])])])],1):t("div",{staticClass:"no-recording-section"},[t("h4",[e._v("录制状态")]),t("van-notice-bar",{attrs:{type:"warning",text:"没有录制数据，请确保在操作前已开始录制"}})],1),t("div",{staticClass:"step-actions"},[e.recordingResult&&e.recordingResult.success?t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.goHome}},[e._v(" 返回首页 ")]):[t("van-button",{staticStyle:{"margin-bottom":"12px"},attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.goToProducts}},[e._v(" 重新开始录制 ")]),t("van-button",{attrs:{type:"default",size:"large",block:"",round:""},on:{click:e.goHome}},[e._v(" 返回首页 ")])]],2)],1)]):e._e()])]):e._e(),t("van-action-sheet",{attrs:{actions:e.redeemTypeActions,"cancel-text":"取消",title:"选择赎回类型"},on:{select:e.onRedeemTypeSelect},model:{value:e.showRedeemTypePicker,callback:function(t){e.showRedeemTypePicker=t},expression:"showRedeemTypePicker"}})],1)])}),De=[],Ae={name:"Redeem",components:{RecordWrapper:ve},data(){return{productId:null,product:null,currentStep:0,redeeming:!1,showRedeemTypePicker:!1,redeemForm:{redeemType:"",amount:"",bankCard:"",password:""},redeemNo:"",redeemTime:"",recordingResult:null,isReplaying:!1,replayPlayer:null,replayerObserver:null,redeemTypeActions:[{name:"全部赎回",value:"full"},{name:"部分赎回",value:"partial"}],products:{1:{id:1,name:"稳健增长理财产品",description:"低风险，稳定收益，适合保守型投资者",expectedReturn:"4.2%",minAmount:"1000元",term:"90天",image:"https://img.yzcdn.cn/vant/cat.jpeg"},2:{id:2,name:"平衡配置理财产品",description:"中等风险，均衡收益，适合稳健型投资者",expectedReturn:"6.8%",minAmount:"5000元",term:"180天",image:"https://img.yzcdn.cn/vant/cat.jpeg"},3:{id:3,name:"成长机会理财产品",description:"高风险高收益，适合积极型投资者",expectedReturn:"9.5%",minAmount:"10000元",term:"365天",image:"https://img.yzcdn.cn/vant/cat.jpeg"}}}},computed:{expectedArrival(){return this.redeemForm.amount?`¥${this.redeemForm.amount}`:"¥0"},maskedBankCard(){if(!this.redeemForm.bankCard)return"";const e=this.redeemForm.bankCard;return e.replace(/(\d{4})\d+(\d{4})/,"$1****$2")}},created(){this.loadProduct()},methods:{loadProduct(){this.productId=parseInt(this.$route.params.id),this.product=this.products[this.productId]},nextStep(){this.currentStep<3&&this.currentStep++},validateAndNext(){this.redeemForm.redeemType?this.redeemForm.amount?this.redeemForm.bankCard?this.redeemForm.password?parseInt(this.redeemForm.amount)<=0?this.$toast.fail("赎回金额必须大于0"):this.redeemForm.bankCard.length<16?this.$toast.fail("请输入正确的银行卡号"):this.redeemForm.password.length<6?this.$toast.fail("交易密码至少6位数"):this.nextStep():this.$toast.fail("请填写交易密码"):this.$toast.fail("请填写收款银行卡号"):this.$toast.fail("请填写赎回金额"):this.$toast.fail("请选择赎回类型")},onFormSubmit(){this.nextStep()},onRedeemTypeSelect(e){this.redeemForm.redeemType=e.name,this.showRedeemTypePicker=!1},async confirmRedeem(){try{const e=(await Promise.resolve().then(s.bind(s,678))).default,t=e.getInstance(),r=t.getRecordingStatus();if(!r.isRecording)return void this.$toast.fail("请先在产品列表页开始录制")}catch(e){return console.error("检查录制状态失败:",e),void this.$toast.fail("录制状态检查失败")}this.redeeming=!0;try{await new Promise((e=>setTimeout(e,2e3))),this.redeemNo="RD"+Date.now(),this.redeemTime=(new Date).toLocaleString(),this.redeeming=!1,this.nextStep(),setTimeout((async()=>{console.log("赎回成功页面已显示，开始停止录制...");const e=(await Promise.resolve().then(s.bind(s,678))).default,t=e.getInstance(),r=t.getRecordingStatus();if(console.log("当前录制状态:",r),r.isRecording)try{await this.stopRecordingAndProcess()}finally{}else console.warn("录制已停止，可能在赎回过程中被中断"),this.recordingResult={success:!1,error:"录制在赎回过程中被中断",message:"录制状态异常，请重新开始录制流程"},this.$toast.fail("录制状态异常")}),1500)}catch(e){console.error("赎回流程出错:",e),this.redeeming=!1,this.$toast.fail("赎回失败，请重试")}},async stopRecordingAndProcess(){try{const e=(await Promise.resolve().then(s.bind(s,678))).default,t=e.getInstance(),r=await t.stopRecordingAndProcess({redeemInfo:{productId:this.productId,productName:this.product.name,amount:this.redeemForm.amount,bankCard:this.maskedBankCard,redeemNo:this.redeemNo,timestamp:Date.now()}});if(console.log("赎回页面：录制数据处理结果:",r),r.success){const e=await t.uploadRecordingData(r.data);console.log("赎回页面：上传结果:",e),this.recordingResult={success:!0,events:r.recordingResult.events,data:r.data,uploadResult:e,stats:{originalSize:r.data.sizes.original,compressedSize:r.data.sizes.compressed,compressionRatio:r.data.compressionRatio,eventCount:r.data.finalData.totalEvents}},this.$toast.success("录制数据处理并上传成功")}else console.warn("赎回页面：录制数据处理失败:",r.error),this.recordingResult={success:!1,error:r.error,message:"录制数据为空"===r.error?"请先在产品列表页面开始录制，然后进行赎回操作":"录制过程中出现错误"},this.$toast.fail("录制数据处理失败: "+r.error)}catch(e){console.error("赎回页面：停止录制并处理数据失败:",e),this.recordingResult={success:!1,error:e.message},this.$toast.fail("录制处理失败: "+e.message)}},async processRecordingData(e){try{const t=JSON.stringify(e),s=new Blob([t]).size;if("undefined"===typeof window.pako)throw new Error("pako压缩库未找到，请确保已正确引入");const r=window.pako,a=r.gzip(t),o=a.length,i=(100*(1-o/s)).toFixed(1)+"%";return{success:!0,events:e.events,originalSize:this.formatFileSize(s),compressedSize:o,dataSize:this.formatFileSize(o),compressionRatio:i,compressedSizeBytes:o,compressedData:Array.from(a),metadata:{...e.metadata,redeemNo:this.redeemNo,redeemAmount:this.redeemForm.amount,redeemType:this.redeemForm.redeemType,processTime:(new Date).toISOString()}}}catch(t){return console.error("处理录制数据失败:",t),{success:!1,error:t.message}}},async optimizeRecordingData(e){try{let t=[...e.events];if(t=t.filter(((e,s)=>!(3===e.type&&1===e.data?.source&&s>0&&3===t[s-1].type))),t.length>1e3){const e=Math.ceil(t.length/1e3);t=t.filter(((t,s)=>s%e===0))}t=t.map((e=>{const t={...e};return e.data&&"object"===typeof e.data&&(delete t.data.isCustom,delete t.data.plugin),t}));const s={...e,events:t,metadata:{...e.metadata,optimized:!0,originalEventCount:e.events.length,optimizedEventCount:t.length}};return await this.processRecordingData(s)}catch(t){return console.error("优化录制数据失败:",t),{success:!1,error:t.message}}},async uploadRecordingData(e){try{const t={type:"redeem_recording",redeemNo:this.redeemNo,productId:this.productId,compressedData:e.compressedData,metadata:e.metadata,size:e.compressedSizeBytes,compressionInfo:{originalSize:e.originalSize,compressedSize:e.dataSize,compressionRatio:e.compressionRatio}};console.log("上传录制数据:",t),await new Promise((e=>setTimeout(e,1e3))),this.$toast.success("录制数据上传成功")}catch(t){console.error("上传录制数据失败:",t),this.$toast.fail("录制数据上传失败")}},formatFileSize(e){if(0===e)return"0 B";const t=1024,s=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+s[r]},async startReplay(){if(this.recordingResult&&this.recordingResult.events)try{this.isReplaying=!0;const e=document.getElementById("replay-container");if(!e)throw new Error("回放容器未找到");e.innerHTML="",e.style.width="100%",e.style.height="600px",e.style.position="relative",e.style.overflow="visible",e.style.border="1px solid #eee",e.style.borderRadius="4px",e.style.backgroundColor="#f5f5f5",console.log("Redeem页面：开始回放，事件数量:",this.recordingResult.events.length),console.log("Redeem页面：前几个事件:",this.recordingResult.events.slice(0,3));const t=this.recordingResult.events;if(!Array.isArray(t)||t.length<2)throw new Error("录制数据格式不正确或事件太少");const s=t.some((e=>4===e.type)),r=t.some((e=>2===e.type));if(!s||!r)throw new Error("录制数据缺少必要的元信息或快照");if("undefined"===typeof window.rrwebPlayer)throw new Error("rrweb-player库未找到，请确保已正确引入");const a=window.rrwebPlayer;console.log("Redeem页面：创建rrweb-player"),this.replayPlayer=new a({target:e,props:{events:t,width:e.offsetWidth||375,height:550,autoPlay:!1,showController:!0,showWarning:!1,showDebug:!1,speed:1,speedOption:[.5,1,1.5,2,4],skipInactive:!1,mouseTail:!1,tags:{"virtual-styles":{}}}}),console.log("Redeem页面：rrweb-player创建成功"),setTimeout((()=>{const t=e.querySelectorAll("iframe");t.forEach((e=>{e.hasAttribute("sandbox")&&e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-modals"),e.style.width="100%",e.style.height="100%",e.style.border="none"})),console.log("Redeem页面：已完成回放器初始化")}),500),this.replayPlayer&&this.replayPlayer.$on&&(this.replayPlayer.$on("finish",(()=>{this.isReplaying=!1,console.log("Redeem页面：回放完成")})),this.replayPlayer.$on("start",(()=>{console.log("Redeem页面：回放开始")}))),this.$toast.success("开始回放赎回流程")}catch(e){console.error("Redeem页面：回放失败:",e),this.isReplaying=!1,this.$toast.fail("回放失败: "+e.message);const t=document.getElementById("replay-container");t&&(t.innerHTML=`\n            <div style="text-align: center; padding: 50px; color: #f56c6c; background: white;">\n              <h4>回放失败</h4>\n              <p style="font-size: 12px; margin-top: 10px;">${e.message}</p>\n              <p style="font-size: 10px; color: #999; margin-top: 10px;">\n                事件数量: ${this.recordingResult.events?this.recordingResult.events.length:0}\n              </p>\n            </div>\n          `)}else this.$toast.fail("没有录制数据可回放")},stopReplay(){if(this.replayPlayer)try{this.replayPlayer.$destroy&&this.replayPlayer.$destroy(),this.replayPlayer=null}catch(t){console.error("停止回放失败:",t)}this.isReplaying=!1;const e=document.getElementById("replay-container");e&&(e.innerHTML='<div style="text-align: center; padding: 50px; color: #999;">回放已停止</div>')},formatFileSize(e){if(0===e)return"0 B";const t=1024,s=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+s[r]},goToProducts(){this.stopReplay(),this.$router.push("/products")},goHome(){this.stopReplay(),this.$router.push("/")},onRecordStarted(){console.log("赎回流程录制开始"),this.$toast.success("开始录制赎回流程")},onRecordStopped(e){console.log("赎回流程录制完成:",e),this.$toast.success("赎回流程录制完成")}},beforeDestroy(){this.stopReplay()}},Ie=Ae,Ne=(0,l.A)(Ie,ze,De,!1,null,"aa4658bc",null),Oe=(Ne.exports,function(){var e=this,t=e._self._c;return t("div",{staticClass:"record-player"},[t("van-nav-bar",{attrs:{title:"录制回放","left-arrow":""},on:{"click-left":function(t){return e.$router.back()}}}),t("div",{staticClass:"content"},[t("van-cell-group",{attrs:{title:"录制记录"}},e._l(e.records,(function(s){return t("van-cell",{key:s.id,attrs:{title:s.title,label:s.description,value:s.duration,"is-link":""},on:{click:function(t){return e.playRecord(s)}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("van-icon",{attrs:{name:"video-o"}})]},proxy:!0}],null,!0)})})),1),e.currentRecord?t("div",{staticClass:"player-container"},[t("h3",[e._v(e._s(e.currentRecord.title))]),t("div",{ref:"playerContainer",staticClass:"player"}),t("div",{staticClass:"player-controls"},[t("van-button",{attrs:{size:"small",icon:e.isPlaying?"pause":"play"},on:{click:e.togglePlay}},[e._v(" "+e._s(e.isPlaying?"暂停":"播放")+" ")]),t("van-button",{attrs:{size:"small",icon:"replay"},on:{click:e.resetPlayer}},[e._v(" 重播 ")]),t("van-button",{attrs:{size:"small",icon:"cross"},on:{click:e.closePlayer}},[e._v(" 关闭 ")])],1)]):e._e(),0===e.records.length?t("div",{staticClass:"empty-state"},[t("van-icon",{attrs:{name:"video-o",size:"50",color:"#dcdee0"}}),t("p",[e._v("暂无录制记录")]),t("van-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.push("/products")}}},[e._v(" 去体验录制功能 ")])],1):e._e()],1)],1)}),Ee=[];class Me{constructor(e={}){this.events=[],this.isRecording=!1,this.stopRecording=null,this.metadata={},this.options={uploadUrl:"/api/record/upload",autoUpload:!0,compressData:!0,maxFileSize:10485760,...e},console.log("ScreenRecorder初始化完成，配置:",this.options)}async startRecording(e={}){if(this.isRecording)return console.log("录制已在进行中"),!0;try{if(console.log("开始录制，元数据:",e),this.metadata=e,this.events=[],"undefined"===typeof window.rrweb)throw new Error("rrweb库未找到，请确保已正确引入");return this.stopRecording=window.rrweb.record({emit:e=>{this.events.push(e)},checkoutEveryNms:3e4,recordCanvas:!0,collectFonts:!0,inlineStylesheet:!0}),this.isRecording=!0,console.log("录制开始成功"),!0}catch(t){return console.error("开始录制失败:",t),this.isRecording=!1,!1}}async stopRecording(){if(!this.isRecording)return console.log("没有正在进行的录制"),null;try{console.log("停止录制..."),this.stopRecording&&(this.stopRecording(),this.stopRecording=null),this.isRecording=!1;const e={events:[...this.events],metadata:this.metadata,timestamp:Date.now(),duration:0,eventsCount:this.events.length};if(console.log("录制停止成功，事件数量:",this.events.length),this.options.autoUpload&&this.events.length>0){console.log("自动上传录制数据...");const t=await this.uploadRecording(e);e.uploadResult=t}return this.events=[],this.metadata={},e}catch(e){return console.error("停止录制失败:",e),this.isRecording=!1,null}}async uploadRecording(e){try{console.log("准备上传录制数据，事件数量:",e.events.length);let t=e;this.options.compressData&&(console.log("开始压缩录制数据..."),t=await this.compressRecordingData(e),console.log("数据压缩完成"));const s=this.getDataSize(t);s>this.options.maxFileSize&&console.warn("录制数据过大:",this.formatFileSize(s)),console.log("上传数据大小:",this.formatFileSize(s));const r=await this.mockUpload(t);return console.log("上传完成:",r),r}catch(t){return console.error("上传录制数据失败:",t),{success:!1,error:t.message}}}async compressRecordingData(e){try{if("undefined"===typeof window.pako)throw new Error("pako压缩库未找到，请确保已正确引入");const t=JSON.stringify(e),s=new Blob([t]).size;console.log("原始数据大小:",this.formatFileSize(s));const r=window.pako.gzip(t),a=r.length;return console.log("压缩后大小:",this.formatFileSize(a)),console.log("压缩率:",(100*(1-a/s)).toFixed(2)+"%"),{...e,compressed:!0,originalSize:s,compressedSize:a,compressedData:Array.from(r)}}catch(t){return console.error("压缩数据失败:",t),e}}async mockUpload(e){return await new Promise((e=>setTimeout(e,1e3+2e3*Math.random()))),{success:!0,uploadId:"upload_"+Date.now(),timestamp:Date.now(),message:"录制数据上传成功"}}getDataSize(e){const t=JSON.stringify(e);return new Blob([t]).size}formatFileSize(e){if(0===e)return"0 B";const t=1024,s=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+s[r]}addCustomEvent(e){this.isRecording&&this.events.push({type:5,timestamp:Date.now(),data:{tag:"custom",payload:e}})}getRecordingStatus(){return{isRecording:this.isRecording,eventsCount:this.events.length,metadata:this.metadata}}}var Be=Me,Le={name:"RecordPlayer",data(){return{records:[{id:1,title:"稳健增长理财产品 - 购买流程",description:"2024-01-15 14:30:25 | 用户操作录制",duration:"2分30秒",action:"purchase",productId:1,events:[]},{id:2,title:"平衡配置理财产品 - 赎回流程",description:"2024-01-15 16:45:12 | 用户操作录制",duration:"1分45秒",action:"redeem",productId:2,events:[]}],currentRecord:null,player:null,isPlaying:!1}},methods:{async playRecord(e){this.currentRecord=e,await this.$nextTick();try{let t=e.events;if(e.compressed&&(t=Be.decompressData(e)),t&&0!==t.length||(t=this.generateDemoEvents()),t.length<2&&(t=this.generateDemoEvents()),"undefined"===typeof window.rrwebPlayer)throw new Error("rrweb-player库未找到，请确保已正确引入");this.player=new window.rrwebPlayer({target:this.$refs.playerContainer,props:{events:t,width:375,height:667,autoPlay:!1,showController:!0,tags:{"virtual-styles":{"background-color":"#f7f8fa"}}}}),setTimeout((()=>{const e=this.$refs.playerContainer.querySelectorAll("iframe");e.forEach((e=>{e.hasAttribute("sandbox")&&(console.log("修复RecordPlayer iframe sandbox权限"),e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-modals"))}))}),100),this.isPlaying=!1,this.$toast.success("录制加载成功")}catch(t){console.error("播放录制失败:",t),this.$toast.fail("播放失败: "+t.message)}},togglePlay(){if(this.player)try{this.isPlaying?this.player.pause():this.player.play(),this.isPlaying=!this.isPlaying}catch(e){console.error("播放控制失败:",e),this.$toast.fail("播放控制失败")}},resetPlayer(){if(this.player)try{this.player.goto(0),this.isPlaying=!1}catch(e){console.error("重置播放器失败:",e)}},closePlayer(){if(this.player){try{this.player.destroy()}catch(e){console.error("销毁播放器失败:",e)}this.player=null}this.currentRecord=null,this.isPlaying=!1},generateDemoEvents(){const e=Date.now();return[{type:4,data:{href:window.location.origin,width:375,height:667},timestamp:e-5e3},{type:2,data:{node:{type:0,childNodes:[{type:1,name:"html",publicId:"",systemId:"",id:2},{type:2,tagName:"html",attributes:{lang:"zh-CN"},childNodes:[{type:2,tagName:"head",attributes:{},childNodes:[{type:2,tagName:"title",attributes:{},childNodes:[{type:3,textContent:"理财产品录制演示",id:5}],id:4}],id:3},{type:2,tagName:"body",attributes:{style:"margin: 0; padding: 20px; font-family: Arial, sans-serif; background-color: #f7f8fa;"},childNodes:[{type:2,tagName:"div",attributes:{style:"text-align: center; padding: 40px 20px; background: white; border-radius: 8px; margin: 20px 0;"},childNodes:[{type:2,tagName:"h2",attributes:{style:"color: #323233; margin-bottom: 20px;"},childNodes:[{type:3,textContent:"理财产品录制演示",id:8}],id:7},{type:2,tagName:"p",attributes:{style:"color: #969799; margin-bottom: 30px;"},childNodes:[{type:3,textContent:"这是一个演示录制回放的示例",id:10}],id:9},{type:2,tagName:"button",attributes:{id:"demo-btn",style:"background: #1989fa; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer;"},childNodes:[{type:3,textContent:"点击按钮",id:12}],id:11}],id:6}],id:13}],id:14}],id:1}},timestamp:e-4e3},{type:3,data:{source:2,type:1,x:187,y:400},timestamp:e-3e3},{type:3,data:{source:2,type:2,x:187,y:400,id:11},timestamp:e-2e3},{type:3,data:{source:0,texts:[{id:12,value:"已点击！"}]},timestamp:e-1e3}]}},beforeDestroy(){this.closePlayer()}},We=Le,qe=(0,l.A)(We,Oe,Ee,!1,null,"49073c18",null),je=(qe.exports,function(){var e=this,t=e._self._c;return t("RecordWrapper",{ref:"recordWrapper",attrs:{"auto-start":!0,"show-controls":!1,"stop-on-destroy":!1,"require-consent":!0,metadata:{action:"purchase-step-1",productId:e.productId,flow:"purchase-start"}},on:{"record-timeout":e.handleRecordTimeout,"timeout-confirmed":e.handleTimeoutConfirmed,"record-started":e.onRecordStarted,"record-declined":e.onRecordDeclined}},[t("div",{staticClass:"purchase-step"},[t("van-nav-bar",{attrs:{title:"确认产品","left-arrow":"",fixed:""},on:{"click-left":function(t){return e.$router.back()}}}),e.product?t("div",{staticClass:"content"},[t("div",{staticClass:"product-info-card"},[t("div",{staticClass:"product-header"},[t("h3",{staticClass:"product-name"},[e._v(e._s(e.product.name))]),t("div",{staticClass:"product-return"},[e._v(e._s(e.product.expectedReturn))])]),t("p",{staticClass:"product-desc"},[e._v(e._s(e.product.description))])]),t("div",{staticClass:"steps-container"},[t("van-steps",{attrs:{active:0,direction:"horizontal"}},[t("van-step",[e._v("确认产品")]),t("van-step",[e._v("填写信息")]),t("van-step",[e._v("确认购买")]),t("van-step",[e._v("购买完成")])],1)],1),t("div",{staticClass:"step-content"},[t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("产品确认")]),t("van-cell-group",[t("van-cell",{attrs:{title:"产品名称",value:e.product.name}}),t("van-cell",{attrs:{title:"预期收益率",value:e.product.expectedReturn}}),t("van-cell",{attrs:{title:"起购金额",value:e.product.minAmount}}),t("van-cell",{attrs:{title:"产品期限",value:e.product.term}})],1),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.nextStep}},[e._v(" 确认产品信息 ")])],1)],1)])]):e._e()],1)])}),He=[],Je={name:"PurchaseStepOne",components:{RecordWrapper:ve},data(){return{productId:null,product:null,products:{1:{id:1,name:"稳健增长理财产品",description:"低风险，稳定收益，适合保守型投资者",expectedReturn:"4.2%",minAmount:"1000元",term:"90天",image:"https://img.yzcdn.cn/vant/cat.jpeg"},2:{id:2,name:"平衡配置理财产品",description:"中等风险，均衡收益，适合稳健型投资者",expectedReturn:"6.8%",minAmount:"5000元",term:"180天",image:"https://img.yzcdn.cn/vant/cat.jpeg"},3:{id:3,name:"成长机会理财产品",description:"高风险高收益，适合积极型投资者",expectedReturn:"9.5%",minAmount:"10000元",term:"365天",image:"https://img.yzcdn.cn/vant/cat.jpeg"}}}},created(){this.loadProduct()},methods:{loadProduct(){if(this.productId=parseInt(this.$route.query.id)||parseInt(this.$route.params.id),this.product=this.products[this.productId],!this.product)return this.$toast.fail("产品不存在"),void this.$router.back()},nextStep(){this.$router.push({name:"PurchaseStepTwo",query:{id:this.productId}})},handleRecordTimeout(){console.log("步骤1：录制超时")},handleTimeoutConfirmed(){this.$router.push("/")},onRecordStarted(){console.log("录制开始")},onRecordDeclined(){console.log("录制拒绝")}}},Ge=Je,Ke=(0,l.A)(Ge,je,He,!1,null,"4949fb18",null),Ue=Ke.exports,Ve=function(){var e=this,t=e._self._c;return t("RecordWrapper",{attrs:{"auto-start":!1,"show-controls":!1,"stop-on-destroy":!1,"require-consent":!1,metadata:{action:"purchase-step-2",productId:e.productId}},on:{"record-timeout":e.handleRecordTimeout,"timeout-confirmed":e.handleTimeoutConfirmed}},[t("div",{staticClass:"purchase-step"},[t("van-nav-bar",{attrs:{title:"填写信息","left-arrow":"",fixed:""},on:{"click-left":function(t){return e.$router.back()}}}),e.product?t("div",{staticClass:"content"},[t("div",{staticClass:"product-info-card"},[t("div",{staticClass:"product-header"},[t("h3",{staticClass:"product-name"},[e._v(e._s(e.product.name))]),t("div",{staticClass:"product-return"},[e._v(e._s(e.product.expectedReturn))])])]),t("div",{staticClass:"steps-container"},[t("van-steps",{attrs:{active:1,direction:"horizontal"}},[t("van-step",[e._v("确认产品")]),t("van-step",[e._v("填写信息")]),t("van-step",[e._v("确认购买")]),t("van-step",[e._v("购买完成")])],1)],1),t("div",{staticClass:"step-content"},[t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("填写购买信息")]),t("van-form",{ref:"purchaseForm",on:{submit:e.onFormSubmit}},[t("van-field",{attrs:{name:"amount",label:"购买金额",placeholder:"请输入购买金额",type:"number",rules:[{required:!0,message:"请填写购买金额"}]},model:{value:e.purchaseForm.amount,callback:function(t){e.$set(e.purchaseForm,"amount",t)},expression:"purchaseForm.amount"}}),t("van-field",{attrs:{name:"bankCard",label:"银行卡号",placeholder:"请输入银行卡号",rules:[{required:!0,message:"请填写银行卡号"}]},model:{value:e.purchaseForm.bankCard,callback:function(t){e.$set(e.purchaseForm,"bankCard",t)},expression:"purchaseForm.bankCard"}}),t("van-field",{attrs:{name:"password",label:"交易密码",placeholder:"请输入交易密码",type:"password",rules:[{required:!0,message:"请填写交易密码"}]},model:{value:e.purchaseForm.password,callback:function(t){e.$set(e.purchaseForm,"password",t)},expression:"purchaseForm.password"}}),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.validateAndNext}},[e._v(" 下一步 ")])],1)],1)],1)])]):e._e()],1)])},Xe=[],Qe={name:"PurchaseStepTwo",components:{RecordWrapper:ve},data(){return{productId:null,product:null,purchaseForm:{amount:"",bankCard:"",password:""},products:{1:{id:1,name:"稳健增长理财产品",description:"低风险，稳定收益，适合保守型投资者",expectedReturn:"4.2%",minAmount:"1000元",term:"90天"},2:{id:2,name:"平衡配置理财产品",description:"中等风险，均衡收益，适合稳健型投资者",expectedReturn:"6.8%",minAmount:"5000元",term:"180天"},3:{id:3,name:"成长机会理财产品",description:"高风险高收益，适合积极型投资者",expectedReturn:"9.5%",minAmount:"10000元",term:"365天"}}}},created(){this.loadProduct(),this.loadFormData()},methods:{loadProduct(){if(this.productId=parseInt(this.$route.query.id)||parseInt(this.$route.params.id),this.product=this.products[this.productId],!this.product)return this.$toast.fail("产品不存在"),void this.$router.back()},loadFormData(){const e=sessionStorage.getItem("purchaseForm");if(e)try{this.purchaseForm=JSON.parse(e)}catch(t){console.error("加载表单数据失败:",t)}},saveFormData(){sessionStorage.setItem("purchaseForm",JSON.stringify(this.purchaseForm))},validateAndNext(){if(!this.purchaseForm.amount)return void this.$toast.fail("请填写购买金额");if(!this.purchaseForm.bankCard)return void this.$toast.fail("请填写银行卡号");if(!this.purchaseForm.password)return void this.$toast.fail("请填写交易密码");const e=parseInt(this.product.minAmount.replace(/[^\d]/g,""));parseInt(this.purchaseForm.amount)<e?this.$toast.fail(`购买金额不能少于${this.product.minAmount}`):this.purchaseForm.bankCard.length<16?this.$toast.fail("请输入正确的银行卡号"):this.purchaseForm.password.length<6?this.$toast.fail("交易密码至少6位数"):(this.saveFormData(),this.$router.push({name:"PurchaseStepThree",query:{id:this.productId}}))},onFormSubmit(){this.validateAndNext()},handleRecordTimeout(){console.log("步骤2：录制超时")},handleTimeoutConfirmed(){this.$router.push("/")}},watch:{purchaseForm:{handler(){this.saveFormData()},deep:!0}}},Ye=Qe,Ze=(0,l.A)(Ye,Ve,Xe,!1,null,"3feb7eb8",null),et=Ze.exports,tt=function(){var e=this,t=e._self._c;return t("RecordWrapper",{attrs:{"auto-start":!1,"show-controls":!1,"stop-on-destroy":!1,"require-consent":!1,metadata:{action:"purchase-step-3",productId:e.productId}},on:{"record-timeout":e.handleRecordTimeout,"timeout-confirmed":e.handleTimeoutConfirmed}},[t("div",{staticClass:"purchase-step"},[t("van-nav-bar",{attrs:{title:"确认购买","left-arrow":"",fixed:""},on:{"click-left":function(t){return e.$router.back()}}}),e.product?t("div",{staticClass:"content"},[t("div",{staticClass:"product-info-card"},[t("div",{staticClass:"product-header"},[t("h3",{staticClass:"product-name"},[e._v(e._s(e.product.name))]),t("div",{staticClass:"product-return"},[e._v(e._s(e.product.expectedReturn))])])]),t("div",{staticClass:"steps-container"},[t("van-steps",{attrs:{active:2,direction:"horizontal"}},[t("van-step",[e._v("确认产品")]),t("van-step",[e._v("填写信息")]),t("van-step",[e._v("确认购买")]),t("van-step",[e._v("购买完成")])],1)],1),t("div",{staticClass:"step-content"},[t("div",{staticClass:"step-card"},[t("h4",{staticClass:"step-title"},[e._v("确认购买信息")]),t("van-cell-group",[t("van-cell",{attrs:{title:"产品名称",value:e.product.name}}),t("van-cell",{attrs:{title:"购买金额",value:`¥${e.purchaseForm.amount}`}}),t("van-cell",{attrs:{title:"预期收益",value:e.expectedProfit}}),t("van-cell",{attrs:{title:"银行卡号",value:e.maskedBankCard}})],1),t("div",{staticClass:"risk-notice"},[t("van-notice-bar",{attrs:{"left-icon":"warning-o",text:"投资有风险，理财产品不保证本金和收益，过往业绩不代表未来表现"}})],1),t("div",{staticClass:"step-actions"},[t("van-button",{attrs:{type:"primary",size:"large",block:"",round:"",loading:e.purchasing},on:{click:e.confirmPurchase}},[e._v(" 确认购买 ")])],1)],1)])]):e._e()],1)])},st=[],rt={name:"PurchaseStepThree",components:{RecordWrapper:ve},data(){return{productId:null,product:null,purchaseForm:{amount:"",bankCard:"",password:""},purchasing:!1,products:{1:{id:1,name:"稳健增长理财产品",description:"低风险，稳定收益，适合保守型投资者",expectedReturn:"4.2%",minAmount:"1000元",term:"90天"},2:{id:2,name:"平衡配置理财产品",description:"中等风险，均衡收益，适合稳健型投资者",expectedReturn:"6.8%",minAmount:"5000元",term:"180天"},3:{id:3,name:"成长机会理财产品",description:"高风险高收益，适合积极型投资者",expectedReturn:"9.5%",minAmount:"10000元",term:"365天"}}}},computed:{expectedProfit(){if(!this.purchaseForm.amount||!this.product)return"¥0";const e=parseFloat(this.product.expectedReturn)/100,t=this.purchaseForm.amount*e;return`¥${t.toFixed(2)}`},maskedBankCard(){if(!this.purchaseForm.bankCard)return"";const e=this.purchaseForm.bankCard;return e.replace(/(\d{4})\d+(\d{4})/,"$1****$2")}},created(){this.loadProduct(),this.loadFormData()},methods:{loadProduct(){if(this.productId=parseInt(this.$route.query.id)||parseInt(this.$route.params.id),this.product=this.products[this.productId],!this.product)return this.$toast.fail("产品不存在"),void this.$router.push("/")},loadFormData(){const e=sessionStorage.getItem("purchaseForm");if(e)try{this.purchaseForm=JSON.parse(e)}catch(t){console.error("加载表单数据失败:",t),this.$toast.fail("表单数据加载失败，请重新填写"),this.$router.push({name:"PurchaseStepTwo",query:{id:this.productId}})}else this.$toast.fail("请先填写购买信息"),this.$router.push({name:"PurchaseStepTwo",query:{id:this.productId}})},async confirmPurchase(){try{const e=(await Promise.resolve().then(s.bind(s,678))).default,t=e.getInstance(),r=t.getRecordingStatus();if(!r.isRecording)return this.$toast.fail("录制已停止，请重新开始购买流程"),void this.$router.push("/")}catch(e){return console.error("检查录制状态失败:",e),void this.$toast.fail("录制状态检查失败")}this.purchasing=!0;try{await new Promise((e=>setTimeout(e,2e3)));const e="PO"+Date.now(),t=(new Date).toLocaleString(),s={orderNo:e,purchaseTime:t,productId:this.productId,productName:this.product.name,amount:this.purchaseForm.amount,expectedProfit:this.expectedProfit,bankCard:this.maskedBankCard};sessionStorage.setItem("orderInfo",JSON.stringify(s)),this.purchasing=!1,this.$router.push({name:"PurchaseStepFour",query:{id:this.productId,orderNo:e}})}catch(e){console.error("购买流程出错:",e),this.purchasing=!1,this.$toast.fail("购买失败，请重试")}},handleRecordTimeout(){console.log("步骤3：录制超时")},handleTimeoutConfirmed(){this.$router.push("/")}}},at=rt,ot=(0,l.A)(at,tt,st,!1,null,"166823a3",null),it=ot.exports,nt=function(){var e=this,t=e._self._c;return t("RecordWrapper",{ref:"recordWrapper",attrs:{"auto-start":!1,"show-controls":!1,"stop-on-destroy":!0,"require-consent":!1,metadata:{action:"purchase-step-4",productId:e.productId}},on:{"record-timeout":e.handleRecordTimeout,"timeout-confirmed":e.handleTimeoutConfirmed,"recording-finished":e.onRecordingFinished}},[t("div",{staticClass:"purchase-step"},[t("van-nav-bar",{attrs:{title:"购买完成","left-arrow":!1,fixed:""}}),t("div",{staticClass:"content"},[t("div",{staticClass:"steps-container"},[t("van-steps",{attrs:{active:3,direction:"horizontal"}},[t("van-step",[e._v("确认产品")]),t("van-step",[e._v("填写信息")]),t("van-step",[e._v("确认购买")]),t("van-step",[e._v("购买完成")])],1)],1),t("div",{staticClass:"step-content"},[t("div",{staticClass:"step-card success-card"},[t("div",{staticClass:"success-content"},[t("van-icon",{attrs:{name:"success",size:"50",color:"#07c160"}}),t("h3",[e._v("购买成功！")]),t("p",[e._v("您已成功购买理财产品")]),e.orderInfo?t("van-cell-group",[t("van-cell",{attrs:{title:"订单号",value:e.orderInfo.orderNo}}),t("van-cell",{attrs:{title:"购买时间",value:e.orderInfo.purchaseTime}}),t("van-cell",{attrs:{title:"产品名称",value:e.orderInfo.productName}}),t("van-cell",{attrs:{title:"购买金额",value:`¥${e.orderInfo.amount}`}}),t("van-cell",{attrs:{title:"预期收益",value:e.orderInfo.expectedProfit}}),t("van-cell",{attrs:{title:"银行卡号",value:e.orderInfo.bankCard}})],1):e._e(),t("div",{staticClass:"recording-status"},[t("h4",[e._v("录制状态")]),null===e.recordingResult?t("div",{staticClass:"status-loading"},[t("van-loading",{attrs:{size:"20"}}),t("span",[e._v("正在处理录制数据...")])],1):e.recordingResult&&"object"===typeof e.recordingResult&&e.recordingResult.success?t("div",{staticClass:"recording-success-section"},[t("van-notice-bar",{attrs:{type:"success",text:"录制数据处理并上传成功"}}),t("div",{staticClass:"success-info"},[t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("事件数量:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.recordingResult?e.recordingResult.recordingResult.eventCount:e.recordingResult.data?e.recordingResult.data.finalData.totalEvents:0))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("原始大小:")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatFileSize(e.recordingResult.data?e.recordingResult.data.sizes.original:0)))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("压缩大小:")]),t("span",{staticClass:"value"},[e._v(e._s(e.formatFileSize(e.recordingResult.data?e.recordingResult.data.sizes.compressed:0)))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("压缩率:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.data?e.recordingResult.data.compressionRatio:"0%"))])]),t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("上传状态:")]),t("van-tag",{attrs:{type:e.recordingResult.uploadResult&&e.recordingResult.uploadResult.success?"success":"danger"}},[e._v(" "+e._s(e.recordingResult.uploadResult&&e.recordingResult.uploadResult.success?"成功":"失败")+" ")])],1),e.recordingResult.uploadResult&&e.recordingResult.uploadResult.success?t("div",{staticClass:"success-item"},[t("span",{staticClass:"label"},[e._v("上传ID:")]),t("span",{staticClass:"value"},[e._v(e._s(e.recordingResult.uploadResult.uploadId||"未知"))])]):e._e()]),e.recordingResult.recordingResult&&e.recordingResult.recordingResult.events?t("div",{staticClass:"replay-section"},[t("h4",[e._v("购买流程回放")]),t("div",{staticClass:"replay-controls"},[t("van-button",{attrs:{type:"primary",size:"small",disabled:e.isReplaying},on:{click:e.startReplay}},[e._v(" "+e._s(e.isReplaying?"正在回放...":"开始回放")+" ")]),e.isReplaying?t("van-button",{attrs:{size:"small"},on:{click:e.stopReplay}},[e._v(" 停止回放 ")]):e._e()],1),t("div",{staticClass:"replay-container",attrs:{id:"step-replay-container"}})]):e._e()],1):t("div",{staticClass:"recording-error-section"},[t("van-notice-bar",{attrs:{type:"danger",text:e.recordingResult?e.recordingResult.message||e.recordingResult.error||"录制失败":"录制处理失败"}})],1)]),t("div",{staticClass:"step-actions"},[e.recordingResult&&"object"===typeof e.recordingResult&&e.recordingResult.success?t("van-button",{attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.goHome}},[e._v(" 返回首页 ")]):[t("van-button",{staticStyle:{"margin-bottom":"12px"},attrs:{type:"primary",size:"large",block:"",round:""},on:{click:e.goToProducts}},[e._v(" 重新开始录制 ")]),t("van-button",{attrs:{type:"default",size:"large",block:"",round:""},on:{click:e.goHome}},[e._v(" 返回首页 ")])]],2)],1)])])])],1)])},lt=[],ct=s(9268),dt={name:"PurchaseStepFour",components:{RecordWrapper:ve,[ct.A.name]:ct.A},data(){return{productId:null,orderInfo:null,recordingResult:null,isReplaying:!1,replayPlayer:null}},watch:{recordingResult:{handler(e,t){console.log("购买完成页面：recordingResult发生变化"),console.log("购买完成页面：旧值:",t),console.log("购买完成页面：新值:",e),console.log("购买完成页面：新值类型:",typeof e),e&&console.log("购买完成页面：新值的属性:",Object.keys(e))},immediate:!0,deep:!0}},async mounted(){this.loadOrderInfo(),setTimeout((()=>{this.finishRecording()}),1500)},beforeDestroy(){this.stopReplay()},methods:{loadOrderInfo(){this.productId=parseInt(this.$route.query.id)||parseInt(this.$route.params.id);const e=sessionStorage.getItem("orderInfo");if(e)try{this.orderInfo=JSON.parse(e)}catch(t){console.error("加载订单信息失败:",t)}this.orderInfo||(this.$toast.fail("订单信息丢失"),this.$router.push("/"))},async finishRecording(){try{if(console.log("购买完成页面：开始完成录制..."),this.$refs.recordWrapper&&"function"===typeof this.$refs.recordWrapper.finishRecording){console.log("购买完成页面：准备调用RecordWrapper.finishRecording");const e=await this.$refs.recordWrapper.finishRecording({purchaseInfo:{...this.orderInfo,timestamp:Date.now(),page:"PurchaseStepFour",action:"purchase-completed"}});console.log("购买完成页面：RecordWrapper.finishRecording返回结果:",e),console.log("购买完成页面：结果类型:",typeof e),e&&"object"===typeof e&&(this.recordingResult=e)}else console.warn("RecordWrapper组件或finishRecording方法不可用"),this.recordingResult={success:!1,error:"录制组件不可用",message:"录制组件不可用，请重新开始录制流程"}}catch(e){console.error("购买完成页面：完成录制失败:",e),this.recordingResult={success:!1,error:e.message,message:"录制完成失败: "+e.message}}},formatFileSize(e){if(0===e)return"0 B";const t=1024,s=["B","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,r)).toFixed(2))+" "+s[r]},goToProducts(){sessionStorage.removeItem("purchaseForm"),sessionStorage.removeItem("orderInfo"),this.$router.push("/")},goHome(){sessionStorage.removeItem("purchaseForm"),sessionStorage.removeItem("orderInfo"),this.$router.push("/")},handleRecordTimeout(){console.log("步骤4：录制超时")},handleTimeoutConfirmed(){this.$router.push("/")},onRecordingFinished(e){console.log("购买完成页面：收到录制完成事件:",e),console.log("购买完成页面：result类型:",typeof e),console.log("购买完成页面：result.success:",e?e.success:"result为空"),e&&"object"===typeof e?(this.recordingResult=e,e.success?this.$toast.success("录制完成并上传成功"):this.$toast.fail("录制完成失败: "+(e.message||e.error))):(console.error("购买完成页面：收到无效的录制结果:",e),this.recordingResult={success:!1,error:"收到无效的录制结果",message:"录制数据格式错误"},this.$toast.fail("录制数据格式错误"))},async startReplay(){if(this.recordingResult&&this.recordingResult.recordingResult&&this.recordingResult.recordingResult.events)try{this.isReplaying=!0;const e=document.getElementById("step-replay-container");if(!e)throw new Error("回放容器未找到");e.innerHTML="",e.style.width="100%",e.style.height="600px",e.style.position="relative",e.style.overflow="visible",e.style.border="1px solid #eee",e.style.borderRadius="4px",e.style.backgroundColor="#f5f5f5",console.log("PurchaseStepFour：开始回放，事件数量:",this.recordingResult.recordingResult.events.length);const t=this.recordingResult.recordingResult.events;if(!Array.isArray(t)||t.length<2)throw new Error("录制数据格式不正确或事件太少");const s=t.some((e=>4===e.type)),r=t.some((e=>2===e.type));if(!s||!r)throw new Error("录制数据缺少必要的元信息或快照");if("undefined"===typeof window.rrwebPlayer)throw new Error("rrweb-player库未找到，请确保已正确引入");const a=window.rrwebPlayer;console.log("PurchaseStepFour：创建rrweb-player"),this.replayPlayer=new a({target:e,props:{events:t,width:e.offsetWidth||375,height:550,autoPlay:!1,showController:!0,showWarning:!1,showDebug:!1,speed:1,speedOption:[.5,1,1.5,2,4],skipInactive:!1,mouseTail:!1,tags:{"virtual-styles":{}}}}),console.log("PurchaseStepFour：rrweb-player创建成功"),setTimeout((()=>{const t=e.querySelectorAll("iframe");t.forEach((e=>{e.hasAttribute("sandbox")&&e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-modals"),e.style.width="100%",e.style.height="100%",e.style.border="none"})),console.log("PurchaseStepFour：已完成回放器初始化")}),500),this.replayPlayer&&this.replayPlayer.$on&&(this.replayPlayer.$on("finish",(()=>{this.isReplaying=!1,console.log("PurchaseStepFour：回放完成")})),this.replayPlayer.$on("start",(()=>{console.log("PurchaseStepFour：回放开始")}))),this.$toast.success("开始回放购买流程")}catch(e){console.error("PurchaseStepFour：回放失败:",e),this.isReplaying=!1,this.$toast.fail("回放失败: "+e.message);const t=document.getElementById("step-replay-container");t&&(t.innerHTML=`\n            <div style="text-align: center; padding: 50px; color: #f56c6c; background: white;">\n              <h4>回放失败</h4>\n              <p style="font-size: 12px; margin-top: 10px;">${e.message}</p>\n              <p style="font-size: 10px; color: #999; margin-top: 10px;">\n                事件数量: ${this.recordingResult.recordingResult&&this.recordingResult.recordingResult.events?this.recordingResult.recordingResult.events.length:0}\n              </p>\n            </div>\n          `)}else this.$toast.fail("没有录制数据可回放")},stopReplay(){if(this.replayPlayer)try{this.replayPlayer.$destroy&&this.replayPlayer.$destroy(),this.replayPlayer=null}catch(t){console.error("停止回放失败:",t)}this.isReplaying=!1;const e=document.getElementById("step-replay-container");e&&(e.innerHTML='<div style="text-align: center; padding: 50px; color: #999;">回放已停止</div>')}}},ut=dt,pt=(0,l.A)(ut,nt,lt,!1,null,"0d9f8de5",null),ht=pt.exports;r.Ay.use(u.Ay);const mt=[{path:"/",name:"ProductList",component:be,meta:{title:"产品列表"}},{path:"/purchase-step/1",name:"PurchaseStepOne",component:Ue,meta:{title:"确认产品"}},{path:"/purchase-step/2",name:"PurchaseStepTwo",component:et,meta:{title:"填写信息"}},{path:"/purchase-step/3",name:"PurchaseStepThree",component:it,meta:{title:"确认购买"}},{path:"/purchase-step/4",name:"PurchaseStepFour",component:ht,meta:{title:"购买完成"}},{path:"/index",redirect:"/"},{path:"*",redirect:"/"}],gt=new u.Ay({mode:"hash",base:"/moblie-rrweb-record/",routes:mt});gt.beforeEach(((e,t,s)=>{e.meta&&e.meta.title&&(document.title=e.meta.title+" - Vue录制系统"),s()}));var vt=gt,yt=s(4917),ft=s(4349),Rt=s(4e3),bt=s(2282),wt=s(1564),Ct=s(6070),_t=s(7396),kt=s(8393),$t=s(3598),Pt=s(8946),xt=s(3288),St=s(5183),Tt=s(8630),Ft=s(7087),zt=s(5585),Dt=s(1392),At=s(168),It=s(2458),Nt=s(6514),Ot=s(2860),Et=s(6110),Mt=s(1828),Bt=s(4806),Lt=s(4197);s(2241);r.Ay.config.productionTip=!1,r.Ay.use(yt.A),r.Ay.use(ft.A),r.Ay.use(Rt.A),r.Ay.use(bt.A),r.Ay.use(wt.A),r.Ay.use(Ct.A),r.Ay.use(_t.A),r.Ay.use(kt.A),r.Ay.use($t.A),r.Ay.use(ct.A),r.Ay.use(Pt.A),r.Ay.use(xt.A),r.Ay.use(St.A),r.Ay.use(Tt.A),r.Ay.use(Ft.A),r.Ay.use(zt.A),r.Ay.use(Dt.A),r.Ay.use(At.A),r.Ay.use(It.A),r.Ay.use(Nt.A),r.Ay.use(Ot.A),r.Ay.use(Et.A),r.Ay.use(Mt.A),r.Ay.use(Bt.A),r.Ay.use(Lt.A),new r.Ay({router:vt,render:e=>e(d)}).$mount("#app")}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}s.m=e,function(){var e=[];s.O=function(t,r,a,o){if(!r){var i=1/0;for(d=0;d<e.length;d++){r=e[d][0],a=e[d][1],o=e[d][2];for(var n=!0,l=0;l<r.length;l++)(!1&o||i>=o)&&Object.keys(s.O).every((function(e){return s.O[e](r[l])}))?r.splice(l--,1):(n=!1,o<i&&(i=o));if(n){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[r,a,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var a,o,i=r[0],n=r[1],l=r[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(l)var d=l(s)}for(t&&t(r);c<i.length;c++)o=i[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},r=self["webpackChunkvue_record_project"]=self["webpackChunkvue_record_project"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[504],(function(){return s(6164)}));r=s.O(r)})();
//# sourceMappingURL=app.d8229a4d.js.map